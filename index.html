<!doctype html>
<html lang="fr">
<head>
  <script>
    // Redirection automatique vers l'espace administrateur lorsqu'on arrive sur l'URL racine
    (function redirectToAdminOnRoot() {
      const { hash } = window.location;
      const isRootHash = hash === "" || hash === "#" || hash === "#/";
      if (!isRootHash) {
        return;
      }

      const isStandaloneDisplay = (() => {
        try {
          const mediaQueryMatch =
            typeof window.matchMedia === "function" && window.matchMedia("(display-mode: standalone)").matches;
          return mediaQueryMatch || window.navigator.standalone === true;
        } catch (error) {
          return window.navigator.standalone === true;
        }
      })();

      const INSTALL_TARGET_STORAGE_KEY = "hp::install::target";

      function readStoredInstallTarget() {
        try {
          const storage = window.localStorage;
          if (!storage) return null;
          const raw = storage.getItem(INSTALL_TARGET_STORAGE_KEY);
          if (!raw || typeof raw !== "string") return null;
          const trimmed = raw.trim();
          if (!trimmed) return null;
          if (/^#\/admin(?:\/|\?|$)/.test(trimmed)) {
            const [rawPath = "", searchPart = ""] = trimmed.split("?");
            const segments = rawPath.replace(/^#\/+/g, "").split("/");
            const normalizedHash = `#/${segments.filter(Boolean).join("/") || "admin"}`;
            return searchPart ? `${normalizedHash}?${searchPart}` : normalizedHash;
          }
          if (!/^#\/u\//.test(trimmed)) return null;
          const [rawPath = "", searchPart = ""] = trimmed.split("?");
          const segments = rawPath.replace(/^#\/+/g, "").split("/");
          if (!segments[1]) return null; // nécessite au moins un UID
          if (segments.length < 3 || !segments[2]) {
            segments[2] = "daily";
          }
          const normalizedHash = `#/${segments.filter(Boolean).join("/")}`;
          return searchPart ? `${normalizedHash}?${searchPart}` : normalizedHash;
        } catch (error) {
          console.warn("[install] target:read", error);
          return null;
        }
      }

      const storedTarget = readStoredInstallTarget();
      if (storedTarget && isStandaloneDisplay) {
        const normalized = storedTarget.replace(/^#/, "");
        window.location.hash = normalized;
        return;
      }

      const target = new URL("admin.html", window.location.href);
      window.location.replace(target.toString());
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#3ea6eb" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Habitudes &amp; Pratique" />
  <title>Habitudes &amp; Pratique</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%20512%20512%27%20role%3D%27img%27%20aria-label%3D%27Habitudes%20et%20Pratique%27%3E%0A%20%20%3Crect%20width%3D%27512%27%20height%3D%27512%27%20rx%3D%27116%27%20fill%3D%27%233EA6EB%27%2F%3E%0A%20%20%3Ctext%20x%3D%2750%25%27%20y%3D%2758%25%27%20text-anchor%3D%27middle%27%20font-family%3D%27%22Segoe%20UI%20Emoji%22%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Noto%20Color%20Emoji%22%2C%20sans-serif%27%20font-size%3D%27260%27%3E%F0%9F%8C%B1%3C%2Ftext%3E%0A%3C%2Fsvg%3E" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%20100%20100%27%20role%3D%27img%27%20aria-label%3D%27Habitudes%20et%20Pratique%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20rx%3D%2722%27%20fill%3D%27%233EA6EB%27%2F%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2760%25%27%20text-anchor%3D%27middle%27%20font-family%3D%27%22Segoe%20UI%20Emoji%22%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Noto%20Color%20Emoji%22%2C%20sans-serif%27%20font-size%3D%2748%27%3E%F0%9F%8C%B1%3C%2Ftext%3E%3C%2Fsvg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Pastels par section (par défaut = daily / bleu doux) */
      --accent-50:  #ECF7FF;
      --accent-200: #CFEBFF;
      --accent-400: #9FD7FF;
      --accent-600: #60BFFD;
      --accent-700: #3EA6EB;

      --card-bg: #ffffff;
      --page-bg: #F6F7FB;
      --text:    #334155; /* slate-700 */
      --muted:   #94A3B8; /* slate-400 */
      --ring:    var(--accent-400);
    }
    /* Pratique = vert doux */
    [data-section="practice"]{
      --accent-50:#F1FBF4; --accent-200:#D8F3E0; --accent-400:#BEE6C8; --accent-600:#8ED6A2; --accent-700:#63C582;
    }
    /* Objectifs = violet doux */
    [data-section="goals"]{
      --accent-50:#F7F3FF; --accent-200:#E9DFFF; --accent-400:#E3D0FF; --accent-600:#C7A7FF; --accent-700:#A884FF;
    }

    body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body{ background:var(--page-bg); color:var(--text); }

    .sr-only {
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    /* Cards blanches, coins 2xl, ombre douce */
    .card{ background:var(--card-bg); border:1px solid #E5E7EB; border-radius:1rem; box-shadow: 0 8px 24px rgba(16,24,40,.06); }

    /* Champs clairs + anneau pastel */
    input, textarea, select{
      background:#fff; border:1px solid #E5E7EB; color:var(--text); border-radius:.75rem; padding:.625rem .75rem;
    }
    input:focus, textarea:focus, select:focus{ outline:none; border-color:var(--ring); box-shadow:0 0 0 3px var(--accent-50); }

    /* Onglets (pills) + état actif coloré */
    .tabs{ display:flex; gap:.5rem; align-items:center; overflow-x:auto; flex-wrap:nowrap; -webkit-overflow-scrolling:touch; }
    .tabs::-webkit-scrollbar{ display:none; }
    body[data-section="admin"] .tabs .tab:not([data-nav="admin"]){ display:none; }
    .tab{ border:1px solid #E5E7EB; background:#fff; border-radius:999px; padding:.5rem .875rem; font-size:.9rem; display:inline-flex; gap:.5rem; align-items:center; white-space:nowrap; flex:0 0 auto; }
    .tab[aria-current="page"]{ background:var(--accent-50); border-color:var(--accent-400); color:#0B4B66; }

    /* cache le bouton Admin partout */
    [data-nav="admin"] { display: none !important; }

    /* Boutons */
    .btn{ border-radius:.75rem; padding:.625rem 1rem; font-weight:600; }
    .btn-primary{ background:var(--accent-600); color:#fff; }
    .btn-primary:hover{ background:var(--accent-700); }
    .btn-ghost{ background:transparent; border:1px solid var(--accent-200); color:#334155; }
    .btn-ghost:hover{ background:var(--accent-50); }
    .btn-danger{ background:#fee2e2; border:1px solid #fecaca; color:#b91c1c; }
    .btn-danger:hover{ background:#fecaca; }

    .install-banner{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; background:var(--accent-50); border:1px solid var(--accent-200); border-radius:1rem; padding:.65rem .85rem; font-size:.85rem; color:#0f172a; margin-bottom:1rem; }
    .install-banner__content{ display:flex; align-items:center; gap:.6rem; flex:1 1 auto; }
    .install-banner__icon{ font-size:1.4rem; }
    .install-banner__text{ display:flex; flex-direction:column; gap:2px; }
    .install-banner__title{ font-weight:600; }
    .install-banner__subtitle{ color:var(--muted); font-size:.8rem; }
    .install-banner__action{ display:inline-flex; align-items:center; gap:.25rem; font-weight:600; color:var(--accent-700); text-decoration:none; font-size:.82rem; flex-shrink:0; background:none; border:0; cursor:pointer; padding:0; font-family:inherit; }
    .install-banner__action:hover,
    .install-banner__action:focus-visible{ text-decoration:underline; outline:none; }

    /* Animation de changement d’onglet */
    @keyframes fadeSlideIn{ from{ opacity:0; transform:translateY(6px);} to{ opacity:1; transform:translateY(0);} }
    .route-enter{ animation: fadeSlideIn .25s ease-out; }

    /* Sidebar cachée par défaut (mode admin != user) */
    #sidebar{ display:none; }

    /* Titre un peu plus petit sur mobile */
    @media (max-width: 640px){
      header h1{ font-size:1rem; }
      .install-banner{ flex-direction:column; align-items:flex-start; text-align:left; }
      .install-banner__action{ padding-top:.25rem; }
    }

    /* utilitaire pour masquer la scrollbar (déjà utilisé ci-dessus) */
    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Journalier — navigation par jour */
    .day-nav {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.5rem;
      padding:.35rem .5rem;
      border:1px solid rgba(148,163,184,.35);
      border-radius:999px;
      background:#fff;
      min-width:12.5rem;
      width:clamp(13rem, 70vw, 18rem);
    }
    .day-nav-btn {
      flex:0 0 auto;
      width:2.25rem;
      height:2.25rem;
      border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--text);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:1.1rem;
      cursor:pointer;
      transition:background .15s ease, border-color .15s ease;
    }
    .day-nav-btn:hover,
    .day-nav-btn:focus-visible {
      background:var(--accent-50);
      border-color:var(--accent-200);
      outline:none;
    }
    .day-nav-label {
      flex:1 1 auto;
      font-weight:600;
      font-size:.95rem;
      text-transform:capitalize;
      color:var(--text);
      display:flex;
      flex-direction:column;
      align-items:center;
      line-height:1.2;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .day-nav-today {
      font-size:.7rem;
      font-weight:500;
      color:var(--muted);
      letter-spacing:.03em;
      text-transform:uppercase;
    }

    /* Journalier — catégories */
    .daily-category {
      position:relative;
      background:#fff;
      border-radius:1.25rem;
      border:1px solid rgba(148,163,184,.2);
      padding:1.5rem 1.75rem;
      box-shadow:0 14px 32px rgba(15,23,42,.06);
    }
    .daily-category__header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding-bottom:.9rem;
      margin-bottom:1.1rem;
      border-bottom:1px solid rgba(148,163,184,.25);
    }
    .daily-category__name {
      font-weight:700;
      font-size:1.15rem;
      text-transform:capitalize;
      color:#0f172a;
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .daily-category__name::before {
      content:"";
      width:.55rem;
      height:.55rem;
      border-radius:999px;
      background:var(--accent-400);
    }
    .daily-category__count {
      font-size:.75rem;
      font-weight:600;
      color:var(--muted);
      padding:.2rem .4rem;
      text-transform:uppercase;
      letter-spacing:.08em;
    }
    .daily-category__items {
      display:grid;
      gap:1.25rem;
    }
    .daily-category__low {
      margin-top:.25rem;
      padding-top:1rem;
    }
    .daily-category__low-summary {
      list-style:none;
      cursor:pointer;
      font-size:.8rem;
      font-weight:600;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:.35rem;
      padding-top:.75rem;
      border-top:1px dashed rgba(148,163,184,.35);
    }
    .daily-category__low-summary::-webkit-details-marker {
      display:none;
    }
    .daily-category__items--nested {
      margin-top:.75rem;
      display:grid;
      gap:1.1rem;
    }
    .daily-consigne {
      background:#fff;
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.22);
      box-shadow:0 6px 16px rgba(15,23,42,.04);
      padding:1rem 1.2rem;
      display:grid;
      gap:.75rem;
      transition:background .2s ease,border-color .2s ease,box-shadow .2s ease;
    }
    .daily-consigne:last-child { border-bottom:none; }
    .daily-consigne__top {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    .daily-consigne__title {
      display:flex;
      flex:1 1 auto;
      flex-wrap:wrap;
      align-items:center;
      gap:.5rem;
    }
    .daily-consigne__field {
      display:block;
    }
    .daily-consigne__actions {
      display:flex;
      flex:0 0 auto;
      align-items:center;
      gap:.25rem;
      font-size:.78rem;
    }
    .daily-consigne__actions .btn {
      padding:.25rem .6rem;
      border:none;
      background:transparent;
      color:var(--muted);
      font-size:.78rem;
      font-weight:500;
    }
    .daily-consigne__actions .btn:hover,
    .daily-consigne__actions .btn:focus-visible {
      color:var(--text);
      background:var(--accent-50);
      border-radius:.5rem;
    }

    .consigne-group {
      display:grid;
      gap:.5rem;
    }
    .consigne-group__children {
      margin-top:-.25rem;
      padding:.35rem .85rem .9rem;
      border-radius:.85rem;
      background:rgba(148,163,184,.08);
    }
    .consigne-group__summary {
      list-style:none;
      cursor:pointer;
      font-size:.8rem;
      font-weight:600;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:.4rem;
      padding:.35rem 0;
    }
    .consigne-group__summary::before {
      content:"▸";
      font-size:.75rem;
      transition:transform .2s ease;
    }
    .consigne-group__children[open] .consigne-group__summary::before {
      transform:rotate(90deg);
    }
    .consigne-group__summary::-webkit-details-marker {
      display:none;
    }
    .consigne-group__list {
      display:grid;
      gap:.75rem;
      margin-top:.5rem;
    }
    .daily-consigne--child {
      margin-left:1.2rem;
    }
    .consigne-card--child {
      margin-left:1rem;
      border-color:rgba(148,163,184,.28);
      box-shadow:none;
    }

    .priority-surface {
      position:relative;
    }
    .priority-surface-high {
      background:#fef2f2;
      border-color:#fecaca;
      box-shadow:0 6px 18px rgba(248,113,113,.18);
    }
    .priority-surface-medium {
      background:#ffffff;
      border-color:#e2e8f0;
    }
    .priority-surface-low {
      background:#f8fafc;
      border-color:#e2e8f0;
      box-shadow:0 4px 14px rgba(148,163,184,.12);
    }

    .consigne-card.priority-surface-high {
      background:#fef2f2;
      border-color:#fecaca;
    }
    .consigne-card.priority-surface-low {
      background:#f8fafc;
      border-color:#e2e8f0;
    }

    .btn-saved{ background:#22C55E; } /* vert doux rapide pour le flash */

    .user-actions{ position:relative; display:flex; align-items:center; }
    .user-actions__trigger{ border:1px solid #E2E8F0; background:#fff; color:#475569; border-radius:999px; width:2.25rem; height:2.25rem; display:inline-flex; align-items:center; justify-content:center; font-size:1.25rem; transition:background .15s ease,border-color .15s ease,color .15s ease; }
    .user-actions__trigger:hover,
    .user-actions__trigger:focus-visible{ background:var(--accent-50); border-color:var(--accent-200); outline:none; color:#0f172a; }
    .user-actions__panel{ position:absolute; right:0; top:calc(100% + .5rem); display:flex; flex-direction:column; min-width:16rem; background:#fff; border:1px solid #E2E8F0; border-radius:1rem; box-shadow:0 20px 40px rgba(15,23,42,.16); padding:.5rem; z-index:40; }
    .user-actions__item{ width:100%; text-align:left; background:none; border:none; padding:.65rem .85rem; border-radius:.75rem; font:inherit; color:inherit; display:flex; align-items:center; gap:.5rem; cursor:pointer; transition:background .15s ease,color .15s ease; }
    .user-actions__item:hover,
    .user-actions__item:focus-visible{ background:var(--accent-50); outline:none; }
    .user-actions__separator{ height:1px; width:100%; background:#e2e8f0; margin:.25rem 0; }

    /* Objectifs */
    .goal-header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap; margin-bottom:12px; }
    .goal-nav{ display:flex; justify-content:center; }
    .goal-nav-button{ width:2.75rem; height:2.75rem; padding:0; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; font-size:1.1rem; }
    .goal-timeline{ display:grid; gap:12px; padding:8px 0; }
    .goal-month{ background:#fff; border-radius:16px; box-shadow:0 10px 28px rgba(79,70,229,.08); padding:16px; border:1px solid rgba(148,163,184,.2); }
    .goal-month--current{ border-color:var(--accent-400); box-shadow:0 12px 32px rgba(99,102,241,.14); }
    .goal-month__header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:1rem; }
    .goal-month__title{ margin:0; font-weight:700; font-size:1.15rem; text-transform:capitalize; }
    .goal-month__add{ padding:.35rem .9rem; border-radius:999px; font-size:.85rem; }
    .goal-monthly{ border:1px dashed rgba(148,163,184,.35); background:rgba(236,233,255,.6); border-radius:14px; padding:.85rem 1rem; margin-bottom:1rem; }
    .goal-monthly__title{ font-size:.85rem; font-weight:600; color:#5b21b6; text-transform:uppercase; letter-spacing:.03em; }
    .goal-week{ padding:10px 0; border-top:1px dashed #e5e7eb; }
    .goal-week:first-of-type{ border-top:none; padding-top:0; }
    .goal-week__header{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; margin-bottom:.45rem; }
    .goal-week__label{ font-size:.82rem; }
    .goal-week__add{ padding:.25rem .75rem; font-size:.78rem; border-radius:999px; }
    .goal-row{ display:flex; flex-direction:column; align-items:flex-start; gap:.75rem; padding:10px 12px; border-radius:12px; transition:background .15s ease, box-shadow .15s ease; border-left:4px solid transparent; }
    .goal-row:hover{ box-shadow:0 6px 14px rgba(15,23,42,.08); }
    .goal-row--positive{ background:#ecfdf5; border-left-color:#22c55e; }
    .goal-row--neutral{ background:#fefce8; border-left-color:#fbbf24; }
    .goal-row--negative{ background:#fef2f2; border-left-color:#f87171; }
    .goal-row--none{ background:#f8fafc; border-left-color:#94a3b8; }
    .goal-row--editable{ cursor:pointer; }
    .goal-row--editable .goal-quick,
    .goal-row--editable .goal-quick *{ cursor:auto; }
    .goal-title{ flex:1; width:100%; }
    .goal-title__button{ display:flex; flex-direction:column; align-items:flex-start; gap:2px; width:100%; background:none; border:none; padding:0; font:inherit; color:inherit; text-align:left; cursor:pointer; }
    .goal-title__button:hover .goal-title__text{ text-decoration:underline; }
    .goal-title__button:focus-visible{ outline:2px solid var(--accent-400); outline-offset:2px; border-radius:6px; }
    .goal-title__text{ font-weight:600; }
    .goal-title__subtitle{ color:var(--muted); font-size:.75rem; }
    .goal-quick{ width:100%; }
    .goal-quick select{ width:100%; }
    .goal-empty{ padding:1rem; border-radius:.75rem; background:var(--accent-50); }
    .select-compact{ font-size:.95rem; padding:4px 8px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }
    .select-compact:focus{ outline:none; border-color:var(--accent-400); box-shadow:0 0 0 3px var(--accent-50); }
    .week-picker{ display:flex; gap:.5rem; }
    .week-picker button.is-active{ background:var(--accent-600); color:#fff; border-color:var(--accent-600); }
    .goal-month-pill{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .75rem; border-radius:999px; background:var(--accent-50); border:1px solid var(--accent-200); font-size:.85rem; font-weight:600; color:#4338ca; }

    .history-scroll{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .history-table{ min-width:720px; }
    .goal-modal{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.68);
      display:grid;
      place-items:center;
      padding:1rem;
      z-index:50;
    }
    .goal-modal-card{ background:#fff; border-radius:1rem; padding:1.25rem 1.5rem; box-shadow:0 24px 48px rgba(15,23,42,.16); width:min(720px,95vw); max-height:90vh; overflow:auto; }
    .goal-modal-header{ display:flex; align-items:flex-start; justify-content:space-between; gap:1rem; }
    .goal-modal-title{ font-weight:700; font-size:1.1rem; }
    .goal-form{ display:grid; gap:1rem; margin-top:1rem; }
    .goal-field{ display:grid; gap:.4rem; }
    .goal-label{ font-size:.85rem; color:var(--muted); }
    .goal-input{ width:100%; }
    .goal-checkbox{ display:inline-flex; align-items:center; gap:.5rem; font-size:.9rem; color:#0f172a; }
    .goal-checkbox input{ width:1.1rem; height:1.1rem; accent-color:var(--accent-500,#4f46e5); }
    .goal-reminder{ display:grid; gap:.35rem; margin-left:1.75rem; }
    .goal-reminder__input{ width:min(220px,100%); }
    .goal-reminder__label{ font-size:.8rem; color:#64748B; }
    .goal-hint{ font-size:.75rem; color:var(--muted); }
    .goal-hint.is-disabled{ opacity:.6; }
    .goal-input[disabled]{ background:#f8fafc; color:#94a3b8; cursor:not-allowed; }
    .goal-actions{ display:flex; justify-content:flex-end; gap:.5rem; flex-wrap:wrap; }
    .goal-actions [data-delete]{ margin-right:auto; }
    .goal-list{ margin-top:.5rem; padding-left:1.25rem; display:grid; gap:.35rem; list-style:disc; }
    .objective-select{ gap:.35rem; }
    .objective-select__meta{ display:flex; align-items:center; flex-wrap:wrap; gap:.4rem; font-size:.8rem; color:#64748b; }
    .objective-select__badge{ display:inline-flex; align-items:center; gap:.35rem; padding:.15rem .6rem; border-radius:999px; background:var(--accent-50); border:1px solid var(--accent-200); font-size:.72rem; font-weight:600; color:#4338ca; }
    .objective-select__period{ font-size:.78rem; color:#475569; }
    .objective-select__placeholder{ font-size:.75rem; color:#94a3b8; }
    .goal-linker{ border:1px solid rgba(148,163,184,.25); background:transparent; border-radius:1rem; padding:.65rem .75rem; display:grid; gap:.65rem; }
    .goal-linker__controls{ display:flex; align-items:center; gap:.75rem; flex-wrap:wrap; }
    .goal-linker__summary{ font-size:.85rem; font-weight:500; color:#334155; }
    .goal-linker__hint{ margin:0; font-size:.8rem; color:#64748b; }
    .goal-linker__panel{ border:1px solid rgba(148,163,184,.25); background:#fff; border-radius:.75rem; padding:.5rem .65rem; display:grid; gap:.4rem; max-height:220px; overflow:auto; box-shadow:0 .35rem 1.2rem rgba(15,23,42,.08); }
    .goal-linker__panel[hidden]{ display:none; }
    .goal-linker__option{ display:grid; grid-template-columns:auto 1fr; align-items:flex-start; gap:.55rem; padding:.3rem .4rem; border-radius:.6rem; transition:background .15s ease, box-shadow .15s ease; }
    .goal-linker__option:hover{ background:rgba(99,102,241,.05); }
    .goal-linker__option input{ width:1.05rem; height:1.05rem; margin-top:.2rem; accent-color:var(--accent-500,#4f46e5); }
    .goal-linker__option-main{ font-weight:600; color:#1f2937; }
    .goal-linker__option-meta{ grid-column:2/span 1; font-size:.75rem; color:#64748b; }
    .goal-linker__empty{ margin:0; font-size:.85rem; color:#64748b; }
    .goal-linker__footer{ display:flex; justify-content:flex-end; }
    .goal-linker__toggle[disabled]{ opacity:.5; cursor:not-allowed; }
    .goal-linker__history[hidden]{ display:none; }


    .practice-dashboard{
      --dashboard-surface:#ffffff;
      --dashboard-border:rgba(15,23,42,.08);
      --dashboard-shadow:0 32px 68px rgba(15,23,42,.18);
      --dashboard-header-bg:#f1f5f9;
      --dashboard-grid-stripe:rgba(241,245,249,.7);
      --dashboard-chip-bg:rgba(148,163,184,.16);
      --dashboard-status-ok:rgba(34,197,94,.16);
      --dashboard-status-ok-text:#166534;
      --dashboard-status-mid:rgba(250,204,21,.18);
      --dashboard-status-mid-text:#92400E;
      --dashboard-status-ko:rgba(248,113,113,.22);
      --dashboard-status-ko-text:#991B1B;
      --dashboard-status-na:#F8FAFC;
      --dashboard-status-na-text:#94A3B8;
    }
    .practice-dashboard.goal-modal{ display:flex; align-items:center; justify-content:center; padding:clamp(.75rem,2vw,1.5rem); }
    .practice-dashboard.goal-modal .modal-card{ padding:0; background:transparent; box-shadow:none; border:0; }
    .practice-dashboard__card{
      position:relative;
      width:min(980px,calc(100vw - 2.5rem));
      max-height:min(94vh,820px);
      display:flex;
      flex-direction:column;
      gap:1.4rem;
      padding:1.65rem clamp(1.35rem,3vw,2rem) 1.8rem;
      background:#fff;
      border:1px solid var(--dashboard-border);
      border-radius:1.5rem;
      box-shadow:0 36px 68px rgba(15,23,42,.18);
      overflow:hidden;
    }
    .practice-dashboard__header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-start;
      justify-content:space-between;
      gap:1.25rem;
      padding:0 0 1.05rem;
      border-bottom:1px solid rgba(148,163,184,.4);
    }
    .practice-dashboard__title-group{ display:flex; flex-direction:column; gap:.35rem; max-width:min(420px,100%); }
    .practice-dashboard__eyebrow{ font-size:.72rem; text-transform:uppercase; letter-spacing:.14em; color:#64748B; font-weight:700; }
    .practice-dashboard__title{ font-size:1.42rem; font-weight:700; color:#111827; letter-spacing:-.01em; }
    .practice-dashboard__subtitle{ font-size:.92rem; color:#475569; line-height:1.45; }
    .practice-dashboard__header-actions{ display:flex; align-items:center; gap:.65rem; flex-wrap:wrap; justify-content:flex-end; padding-top:.15rem; }
    .practice-dashboard__close{ border-color:transparent; background:rgba(148,163,184,.16); color:#0f172a; transition:background .15s ease, transform .15s ease; }
    .practice-dashboard__close:hover{ background:rgba(148,163,184,.26); transform:translateY(-1px); }
    .practice-dashboard__close:focus-visible{ outline:3px solid var(--accent-200); outline-offset:2px; }
    .practice-dashboard__section{ display:flex; flex-direction:column; gap:1rem; background:#fff; border:1px solid rgba(148,163,184,.32); border-radius:1.2rem; padding:1.35rem clamp(1rem,2.6vw,1.6rem); box-shadow:0 20px 40px rgba(15,23,42,.1); overflow:hidden; }
    .practice-dashboard__section-head{ display:flex; align-items:flex-start; justify-content:space-between; gap:.75rem; flex-wrap:wrap; padding-bottom:.85rem; border-bottom:1px solid rgba(226,232,240,.9); }
    .practice-dashboard__section-title{ font-weight:700; font-size:1.05rem; color:#111827; letter-spacing:-.01em; }
    .practice-dashboard__section-subtitle{ font-size:.85rem; color:#64748B; margin-top:.2rem; }
    .practice-dashboard__body{ flex:1 1 auto; overflow-y:auto; padding-right:.25rem; margin-right:-.25rem; display:flex; flex-direction:column; gap:1.5rem; }
    .practice-dashboard__layout{ display:grid; grid-template-columns:minmax(0,1.1fr) minmax(0,.9fr); gap:1.35rem; align-items:flex-start; }
    .practice-dashboard__aside{ display:flex; flex-direction:column; gap:1.1rem; }
    .practice-dashboard__summary{ display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:.85rem; }
    .practice-dashboard__summary-card{ display:flex; flex-direction:column; gap:.35rem; padding:1.1rem 1.2rem; border-radius:1.1rem; background:linear-gradient(160deg, rgba(59,130,246,.1) 0%, rgba(14,165,233,.12) 55%, rgba(14,165,233,.08) 100%); border:1px solid rgba(148,163,184,.28); box-shadow:0 16px 32px rgba(15,23,42,.12); }
    .practice-dashboard__summary-value{ font-size:1.55rem; font-weight:700; color:#0f172a; letter-spacing:-.01em; }
    .practice-dashboard__summary-label{ font-size:.78rem; text-transform:uppercase; letter-spacing:.08em; color:#475569; font-weight:600; }
    .practice-dashboard__insights{ display:flex; flex-direction:column; gap:1rem; padding:1.25rem 1.35rem; border-radius:1.2rem; background:#fff; border:1px solid rgba(148,163,184,.28); box-shadow:0 18px 38px rgba(15,23,42,.12); }
    .practice-dashboard__insights-head{ display:flex; flex-direction:column; gap:.35rem; }
    .practice-dashboard__insights-title{ font-size:1.02rem; font-weight:700; color:#0f172a; }
    .practice-dashboard__insights-meta{ font-size:.8rem; color:#64748B; }
    .practice-dashboard__insights-list{ list-style:none; padding:0; margin:0; display:grid; gap:.85rem; }
    .practice-dashboard__insight{ display:grid; grid-template-columns:auto 1fr; gap:.75rem; align-items:flex-start; padding:.85rem; border-radius:1.1rem; background:#f8fafc; border:1px solid rgba(148,163,184,.25); box-shadow:0 14px 30px rgba(15,23,42,.1); }
    .practice-dashboard__insight-icon{ width:2.1rem; height:2.1rem; border-radius:999px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; background:rgba(79,70,229,.12); color:#4338ca; }
    .practice-dashboard__insight-icon[data-status="ok"]{ background:rgba(34,197,94,.15); color:#166534; }
    .practice-dashboard__insight-icon[data-status="mid"]{ background:rgba(250,204,21,.18); color:#b45309; }
    .practice-dashboard__insight-icon[data-status="ko"]{ background:rgba(248,113,113,.2); color:#b91c1c; }
    .practice-dashboard__insight-icon[data-status="na"]{ background:rgba(148,163,184,.22); color:#1f2937; }
    .practice-dashboard__insight-content{ display:flex; flex-direction:column; gap:.35rem; }
    .practice-dashboard__insight-title{ font-weight:600; font-size:.95rem; color:#0f172a; }
    .practice-dashboard__insight-meta{ font-size:.78rem; color:#64748B; text-transform:uppercase; letter-spacing:.08em; }
    .practice-dashboard__insight-text{ font-size:.85rem; color:#475569; line-height:1.5; margin:0; }
    .practice-dashboard__insights-empty{ margin:0; font-size:.85rem; color:#64748B; }
    .practice-dashboard__legend{ display:flex; flex-direction:column; gap:.6rem; padding:1.05rem 1.2rem; border-radius:1.1rem; background:#fff; border:1px solid rgba(148,163,184,.25); box-shadow:0 14px 30px rgba(15,23,42,.1); }
    .practice-dashboard__legend-title{ font-size:.88rem; font-weight:700; color:#0f172a; }
    .practice-dashboard__legend-list{ list-style:none; padding:0; margin:0; display:grid; gap:.5rem; font-size:.82rem; color:#475569; }
    .practice-dashboard__legend-item{ display:flex; align-items:center; gap:.55rem; }
    .practice-dashboard__legend-dot{ width:.75rem; height:.75rem; border-radius:999px; background:#CBD5F5; box-shadow:0 0 0 4px rgba(203,213,225,.35); }
    .practice-dashboard__legend-dot.is-ok{ background:var(--dashboard-status-ok-text); box-shadow:0 0 0 4px rgba(34,197,94,.22); }
    .practice-dashboard__legend-dot.is-mid{ background:#f59e0b; box-shadow:0 0 0 4px rgba(250,204,21,.26); }
    .practice-dashboard__legend-dot.is-ko{ background:#ef4444; box-shadow:0 0 0 4px rgba(248,113,113,.26); }
    .practice-dashboard__legend-dot.is-na{ background:#94A3B8; box-shadow:0 0 0 4px rgba(148,163,184,.28); }
    .practice-dashboard__table-wrapper{
      position:relative;
      border:1px solid var(--dashboard-border);
      border-radius:1.1rem;
      overflow:auto;
      background:linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      box-shadow:0 20px 38px rgba(15,23,42,.12);
    }
    .practice-dashboard__table-wrapper::after{ content:""; position:absolute; top:0; right:0; bottom:0; width:2.5rem; pointer-events:none; background:linear-gradient(90deg, rgba(248,250,252,0) 0%, rgba(248,250,252,.92) 65%, rgba(248,250,252,1) 100%); }
    .practice-dashboard__table-wrapper::-webkit-scrollbar{ height:8px; }
    .practice-dashboard__table-wrapper::-webkit-scrollbar-thumb{ background:#CBD5F5; border-radius:999px; }
    .practice-dashboard__matrix{ width:100%; border-collapse:separate; border-spacing:0; min-width:660px; }
    .practice-dashboard__matrix thead th{ position:sticky; top:0; background:var(--dashboard-header-bg); padding:.6rem .75rem; text-align:center; font-size:.7rem; text-transform:uppercase; letter-spacing:.08em; color:#64748B; border-bottom:1px solid rgba(148,163,184,.35); z-index:5; }
    .practice-dashboard__matrix thead th:first-child{ left:0; z-index:6; box-shadow:1px 0 0 rgba(226,232,240,.45); }
    .practice-dashboard__matrix thead th span{ display:block; white-space:nowrap; }
    .practice-dashboard__matrix-head-consigne{ text-align:left; min-width:220px; }
    .practice-dashboard__matrix-consigne{ position:sticky; left:0; background:var(--dashboard-surface); padding:.75rem .9rem; border-right:1px solid rgba(226,232,240,.65); box-shadow:1px 0 0 rgba(226,232,240,.45); z-index:4; }
    .practice-dashboard__row-head{ display:flex; align-items:center; gap:.75rem; }
    .practice-dashboard__row-indicator{ width:.45rem; height:2.5rem; border-radius:999px; background:var(--row-accent,#CBD5F5); flex-shrink:0; }
    .practice-dashboard__row-info{ display:flex; flex-direction:column; gap:.35rem; }
    .practice-dashboard__consigne-name{ font-weight:600; font-size:.95rem; color:#0f172a; }

    .subconsigne-row {
      display:grid;
      grid-template-columns:minmax(0,1fr) auto;
      gap:.75rem;
      align-items:flex-start;
      padding:.75rem;
      border:1px solid #e2e8f0;
      border-radius:.75rem;
      background:#f8fafc;
    }
    .subconsigne-row__main { display:grid; gap:.5rem; }
    .subconsigne-row__actions { display:flex; align-items:center; }
    .subconsigne-row__actions .btn { margin-left:auto; }
    #subconsignes-list[data-has-items] .subconsigne-empty { display:none; }
    .subconsigne-empty {
      font-size:.85rem;
      color:var(--muted);
      padding:.5rem 0;
    }
    .practice-dashboard__row-meta{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    .practice-dashboard__matrix tbody td{ padding:.45rem .35rem; text-align:center; }
    .practice-dashboard__matrix tbody tr:nth-child(even){ background:var(--dashboard-grid-stripe); }
    .practice-dashboard__cell{ position:relative; width:100%; min-width:3.5rem; padding:.55rem .35rem; border-radius:.75rem; border:1px solid transparent; font-weight:600; font-size:.85rem; background:#F8FAFC; color:#0f172a; display:flex; align-items:center; justify-content:center; transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease; font-variant-numeric:tabular-nums; line-height:1.35; }
    .practice-dashboard__cell--ok{ background:var(--dashboard-status-ok); color:var(--dashboard-status-ok-text); }
    .practice-dashboard__cell--mid{ background:var(--dashboard-status-mid); color:var(--dashboard-status-mid-text); }
    .practice-dashboard__cell--ko{ background:var(--dashboard-status-ko); color:var(--dashboard-status-ko-text); }
    .practice-dashboard__cell--na{ background:var(--dashboard-status-na); color:var(--dashboard-status-na-text); border-color:#E2E8F0; }
    .practice-dashboard__cell--empty{ font-weight:500; }
    .practice-dashboard__cell[data-has-note="1"]::after{ content:""; position:absolute; top:6px; right:6px; width:8px; height:8px; border-radius:999px; background:#0EA5E9; }
    .practice-dashboard__cell:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(15,23,42,.12); border-color:rgba(148,163,184,.35); }
    .practice-dashboard__cell:focus-visible{ outline:3px solid var(--accent-200); outline-offset:2px; }
    .practice-dashboard__hint{ font-size:.82rem; color:#475569; text-align:right; }
    .practice-dashboard__chart-panel{ display:flex; flex-direction:column; gap:1rem; }
    .practice-dashboard__chart-scroll{ border-radius:1.1rem; overflow-x:auto; padding:.55rem; padding-bottom:.25rem; margin-bottom:-.25rem; cursor:grab; -webkit-overflow-scrolling:touch; touch-action:pan-y; scroll-snap-type:x proximity; background:linear-gradient(135deg, rgba(241,245,249,.9) 0%, rgba(255,255,255,1) 60%); border:1px solid rgba(226,232,240,.85); box-shadow:inset 0 1px 0 rgba(255,255,255,.85); }
    .practice-dashboard__chart-scroll:focus-visible{ outline:3px solid var(--accent-200); outline-offset:2px; }
    .practice-dashboard__chart-scroll.is-dragging{ cursor:grabbing; user-select:none; }
    .practice-dashboard__chart-scroll::-webkit-scrollbar{ height:10px; }
    .practice-dashboard__chart-scroll::-webkit-scrollbar-track{ background:transparent; }
    .practice-dashboard__chart-scroll::-webkit-scrollbar-thumb{ background:#CBD5F5; border-radius:999px; }
    .practice-dashboard__chart-card{
      position:relative;
      border:1px solid rgba(148,163,184,.22);
      border-radius:1.15rem;
      background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%);
      padding:1rem 1.25rem 1.2rem;
      min-height:240px;
      box-shadow:0 16px 32px rgba(15,23,42,.1);
    }
    .practice-dashboard__chart-card::before{ content:""; position:absolute; inset:0; border-radius:inherit; box-shadow:inset 0 1px 0 rgba(255,255,255,.8); pointer-events:none; }
    .practice-dashboard__chart-canvas{ position:relative; min-height:220px; min-width:520px; }
    .practice-dashboard__chart-card canvas{ width:100%; height:100%; }
    .practice-dashboard__chart-caption{ font-size:.82rem; color:#475569; background:#fff; border-radius:.75rem; padding:.55rem .75rem; box-shadow:0 8px 18px rgba(15,23,42,.08); }
    .practice-dashboard__chart-caption:empty{ display:none; }
    .practice-dashboard__chart-actions{ display:flex; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; gap:.85rem; padding-top:.9rem; border-top:1px solid rgba(226,232,240,.85); }
    .practice-dashboard__chart-controls{ display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; justify-content:flex-end; margin-top:0; flex:1 1 260px; }
    .practice-dashboard__chart-zoom{ display:inline-flex; flex-wrap:wrap; gap:.35rem; align-items:center; padding:.35rem .4rem; border-radius:999px; background:#fff; border:1px solid rgba(148,163,184,.35); box-shadow:0 14px 32px rgba(15,23,42,.12); flex:0 0 auto; }
    .practice-dashboard__zoom-btn{ border:1px solid rgba(148,163,184,.45); background:rgba(248,250,252,.9); border-radius:999px; padding:.45rem 1rem; font-size:.82rem; font-weight:600; color:#1f2937; transition:background .15s ease,color .15s ease,box-shadow .15s ease,border-color .15s ease; }
    .practice-dashboard__zoom-btn:hover{ background:#e2e8f0; border-color:rgba(148,163,184,.65); }
    .practice-dashboard__zoom-btn.is-active{ background:var(--accent-600); color:#fff; border-color:var(--accent-600); box-shadow:0 12px 26px rgba(62,166,235,.35); cursor:default; }
    .practice-dashboard__footer{ margin-top:auto; padding-top:1rem; border-top:1px solid rgba(226,232,240,.9); display:flex; align-items:center; justify-content:flex-end; gap:.75rem; }
    .practice-dashboard__footer-actions{ display:flex; gap:.6rem; }
    .practice-dashboard__filter{ display:flex; flex-direction:column; gap:.3rem; font-size:.78rem; color:#475569; }
    .practice-dashboard__filter-label{ font-weight:600; text-transform:uppercase; letter-spacing:.08em; color:#0f172a; }
    .practice-dashboard__filter-select{ border:1px solid #CBD5F5; border-radius:.8rem; padding:.4rem .7rem; font-size:.88rem; color:#0f172a; background:#fff; min-width:180px; box-shadow:0 6px 14px rgba(15,23,42,.08); }
    .practice-dashboard__filter-select:focus-visible{ outline:3px solid var(--accent-200); outline-offset:1px; border-color:var(--accent-400); }
    .practice-dashboard__view-toggle{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:.35rem;
      border-radius:.95rem;
      background:#fff;
      box-shadow:0 14px 32px rgba(15,23,42,.14);
      border:1px solid rgba(148,163,184,.35);
    }
    .practice-dashboard__view-btn{ border:0; background:transparent; padding:.45rem 1rem; border-radius:.8rem; font-size:.82rem; font-weight:600; color:#1f2937; cursor:pointer; transition:background .15s ease,color .15s ease,box-shadow .15s ease; }
    .practice-dashboard__view-btn:hover:not(:disabled){ background:#f1f5f9; }
    .practice-dashboard__view-btn.is-active{ background:var(--accent-600); color:#fff; box-shadow:0 12px 26px rgba(62,166,235,.35); }
    .practice-dashboard__view-btn:disabled{ opacity:.55; cursor:default; }
    .practice-dashboard__view-btn:focus-visible{ outline:3px solid var(--accent-200); outline-offset:2px; }
    .practice-dashboard__chart-option{ display:inline-flex; align-items:center; gap:.4rem; padding:.4rem .7rem; border-radius:.85rem; background:#fff; border:1px solid rgba(148,163,184,.38); font-size:.82rem; color:#1f2937; box-shadow:0 12px 24px rgba(15,23,42,.08); }
    .practice-dashboard__chart-option input{ accent-color:var(--accent-600); }
    .practice-dashboard__chart-empty{ font-size:.85rem; color:#64748B; }
    .practice-dashboard__empty{ padding:1.25rem; border-radius:1rem; border:1px dashed #CBD5F5; background:#F8FAFC; font-size:.9rem; color:#475569; text-align:center; }
    .practice-dashboard__empty-row{ padding:2rem 1rem; text-align:center; font-size:.9rem; color:#94A3B8; }
    @media (min-width: 1024px){
      .practice-dashboard__layout{ grid-template-columns:minmax(0,1.05fr) minmax(0,.95fr); gap:1.5rem; }
      .practice-dashboard__section--chart{ height:100%; }
    }
    @media (max-width: 1024px){
      .practice-dashboard__card{ width:min(100%,calc(100vw - 1.5rem)); }
      .practice-dashboard__layout{ grid-template-columns:1fr; }
    }
    @media (max-width: 768px){
      .practice-dashboard.goal-modal{ padding:0; align-items:stretch; }
      .practice-dashboard.goal-modal .practice-dashboard__card{ width:100%; max-height:100dvh; min-height:100dvh; border-radius:0; box-shadow:none; border:0; padding:1.35rem clamp(1rem,4vw,1.5rem) 1.6rem; }
      .practice-dashboard.goal-modal .practice-dashboard__card{ padding-top:calc(env(safe-area-inset-top,0) + 1.35rem); }
      .practice-dashboard__body{ padding-right:0; margin-right:0; gap:1.35rem; }
      .practice-dashboard__layout{ gap:1.2rem; }
      .practice-dashboard__aside{ order:-1; }
      .practice-dashboard__header{ flex-direction:column; align-items:flex-start; gap:.85rem; padding:.15rem 0 .85rem; border-bottom:1px solid rgba(226,232,240,.9); }
      .practice-dashboard__header-actions{ width:100%; flex-direction:column; align-items:stretch; gap:.6rem; justify-content:flex-start; padding-top:0; }
      .practice-dashboard__view-toggle{ width:100%; justify-content:space-between; }
      .practice-dashboard__view-btn{ flex:1 1 auto; text-align:center; }
      .practice-dashboard__filter-select{ width:100%; }
      .practice-dashboard__chart-panel{ gap:.75rem; }
      .practice-dashboard__chart-card{ min-height:220px; padding:.95rem 1.05rem 1.15rem; }
      .practice-dashboard__chart-canvas{ min-width:min(520px,100%); }
      .practice-dashboard__chart-actions{ flex-direction:column; align-items:stretch; }
      .practice-dashboard__chart-zoom,
      .practice-dashboard__chart-controls{ flex-direction:column; align-items:stretch; gap:.45rem; }
      .practice-dashboard__chart-option{ justify-content:space-between; }
      .practice-dashboard__table-wrapper{ box-shadow:0 16px 28px rgba(15,23,42,.1); }
      .practice-dashboard__hint{ text-align:left; }
      .practice-dashboard__footer{ flex-direction:column; align-items:stretch; gap:.65rem; }
      .practice-dashboard__footer-actions{ justify-content:flex-end; }
    }
    @media (max-width: 640px){
      .practice-dashboard__title{ font-size:1.12rem; }
      .practice-dashboard__section-title{ font-size:.95rem; }
      .practice-dashboard__subtitle{ font-size:.88rem; }
      .practice-dashboard__summary{ grid-template-columns:1fr; }
      .practice-dashboard__insight{ grid-template-columns:1fr; }
      .practice-dashboard__insight-icon{ width:1.85rem; height:1.85rem; }
      .practice-dashboard__table-wrapper{ padding:0; background:transparent; border:0; box-shadow:none; overflow:visible; }
      .practice-dashboard__table-wrapper::after{ display:none; }
      .practice-dashboard__matrix{ width:100%; min-width:0; border-collapse:separate; border-spacing:0; }
      .practice-dashboard__matrix thead{ display:none; }
      .practice-dashboard__matrix tbody{ display:flex; flex-direction:column; gap:1rem; }
      .practice-dashboard__matrix tbody tr{ position:relative; display:flex; flex-direction:column; gap:.75rem; padding:1rem clamp(.75rem,4vw,1.25rem); border-radius:1.15rem; background:#fff; box-shadow:0 14px 30px rgba(15,23,42,.12); border:1px solid rgba(226,232,240,.6); }
      .practice-dashboard__matrix tbody td{ padding:0; text-align:left; }
      .practice-dashboard__matrix-consigne{ position:static; left:auto; background:transparent; padding:0; border-right:0; box-shadow:none; }
      .practice-dashboard__row-head{ gap:.65rem; align-items:flex-start; }
      .practice-dashboard__row-indicator{ height:1.75rem; }
      .practice-dashboard__row-info{ gap:.2rem; }
      .practice-dashboard__matrix tbody tr::after{ content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none; opacity:.08; background:linear-gradient(135deg,var(--accent-50) 0%,transparent 70%); z-index:0; }
      .practice-dashboard__matrix tbody tr > *{ position:relative; z-index:1; }
      .practice-dashboard__matrix tbody tr:nth-child(even)::after{ background:linear-gradient(135deg,var(--accent-200) 0%,transparent 70%); }
      .practice-dashboard__cell{ width:100%; min-width:0; padding:.65rem .75rem; justify-content:flex-start; align-items:flex-start; gap:.35rem; text-align:left; font-size:.92rem; }
      .practice-dashboard__cell::before{ content:attr(data-label); font-size:.7rem; font-weight:600; letter-spacing:.08em; text-transform:uppercase; color:#64748B; }
      .practice-dashboard__cell[data-has-note="1"]::after{ top:8px; right:8px; }
      .practice-dashboard__cell:hover{ transform:none; box-shadow:0 8px 18px rgba(15,23,42,.12); }
      .practice-dashboard__hint{ margin-top:-.25rem; }
    }

    .practice-editor{ display:flex; flex-direction:column; gap:1rem; }
    .practice-editor__header{ display:flex; flex-direction:column; gap:.25rem; }
    .practice-editor__title{ font-size:1.05rem; font-weight:600; color:#0f172a; }
    .practice-editor__subtitle{ font-size:.85rem; color:#475569; }
    .practice-editor__section{ display:flex; flex-direction:column; gap:.4rem; }
    .practice-editor__label{ font-size:.75rem; text-transform:uppercase; letter-spacing:.08em; color:#475569; font-weight:600; }
    .practice-editor__value{ font-size:.9rem; color:#1f2937; }
    .practice-editor__input,
    .practice-editor__select,
    .practice-editor__textarea{ width:100%; border:1px solid #E2E8F0; border-radius:.75rem; padding:.55rem .7rem; font-size:.9rem; color:#334155; }
    .practice-editor__textarea{ min-height:96px; resize:vertical; }
    .practice-editor__input:focus-visible,
    .practice-editor__select:focus-visible,
    .practice-editor__textarea:focus-visible{ outline:3px solid var(--accent-200); outline-offset:1px; border-color:var(--accent-400); }
    .practice-editor__actions{ position:sticky; bottom:0; display:flex; justify-content:flex-end; gap:.5rem; padding:1rem 0 0; margin-top:1.25rem; border-top:1px solid #e2e8f0; background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%); }

  </style>
</head>
<body class="min-h-screen">
  <div class="flex min-h-screen flex-col">
    <header class="border-b border-gray-200 bg-white">
      <div class="mx-auto w-full max-w-5xl px-4 py-4 relative">
        <div class="install-banner hidden" id="install-banner" aria-hidden="true">
          <div class="install-banner__content">
            <span class="install-banner__icon" aria-hidden="true">📲</span>
            <div class="install-banner__text">
              <span class="install-banner__title">Télécharger l’application</span>
              <span class="install-banner__subtitle">Ajoutez-la à votre écran d’accueil pour un accès rapide.</span>
            </div>
          </div>
          <button type="button" class="install-banner__action" id="install-banner-action" data-install-trigger>Télécharger</button>
        </div>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <h1 class="text-lg sm:text-xl font-semibold pr-12 sm:pr-0">
            Habitudes &amp; Pratique
            <span id="user-badge" style="margin-left:.5rem;color:#94a3b8;font-weight:600;">
              — <span data-username>…</span>
            </span>
          </h1>
          <nav class="tabs w-full sm:w-auto overflow-x-auto no-scrollbar">
            <button class="tab" data-route="#/admin" data-nav="admin"><span>🛠️</span><span>Admin</span></button>
            <button class="tab" data-route="#/daily"><span>📅</span><span>Journalier</span></button>
            <button class="tab" data-route="#/practice"><span>⚡</span><span>Pratique</span></button>
            <button class="tab" data-route="#/goals"><span>🎯</span><span>Objectifs</span></button>
          </nav>
          <div class="user-actions hidden absolute right-4 top-4 sm:static" id="user-actions" aria-hidden="true">
            <button type="button" class="user-actions__trigger" id="user-actions-trigger" aria-haspopup="true" aria-expanded="false" title="Actions">
              ⋮
            </button>
            <div class="user-actions__panel hidden" id="user-actions-panel" role="menu">
            <button type="button"
                    class="user-actions__item"
                    id="user-actions-notifications"
                    data-notif-toggle
                    data-uid=""
                    data-enabled="0"
                    role="menuitem">
              🔔 Activer les notifications
            </button>
            <div class="user-actions__separator" role="presentation"></div>
            <button type="button"
                    class="user-actions__item hidden"
                    id="install-app-button"
                    data-install-trigger
                    role="menuitem">
              📱 Ajouter à l’écran d’accueil
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="mx-auto flex w-full max-w-5xl flex-col gap-4 px-4 py-6">
        <aside id="sidebar"></aside>
        <div id="view-root">Chargement…</div>
      </div>
    </main>

    <footer class="border-t border-gray-200 py-6 text-center text-sm text-[var(--muted)]">
      &copy; Habitudes &amp; Pratique
    </footer>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>
  <script src="schema.js"></script>
  <script src="modes.js"></script>
  <script src="goals.js"></script>
  <script src="autosave.js"></script>
  <script src="app.js"></script>
  <script>
    (function initApp() {
      if (!window.firebase) {
        console.error("Firebase non chargé");
        return;
      }
      const cfg = {
        apiKey: "AIzaSyAQcvZ9a2j4MHF04RjMHIey0R_iwnjZf4o",
        authDomain: "tracking-d-habitudes.firebaseapp.com",
        projectId: "tracking-d-habitudes",
        storageBucket: "tracking-d-habitudes.firebasestorage.app",
        messagingSenderId: "739389871966",
        appId: "1:739389871966:web:684e26dbdfb0c0a69221cf",
        measurementId: "G-ZPHWB5DKWF"
      };
      const app = firebase.initializeApp(cfg);
      const db = firebase.firestore(app);
      if (typeof startRouter === "function") {
        startRouter(app, db);
      } else {
        console.error("startRouter indisponible");
      }
    })();
  </script>
  <script>
    (function registerAppServiceWorker() {
      if (!("serviceWorker" in navigator)) {
        return;
      }

      if (window.__appSWRegistrationPromise) {
        return;
      }

      const primarySwUrl = new URL("firebase-messaging-sw.js", window.location.href);
      const legacySwUrl = new URL("sw.js", window.location.href);
      window.__appSWRegistrationPromise = navigator.serviceWorker
        .getRegistration()
        .then((existing) => {
          if (existing) {
            const scriptUrl =
              existing.active?.scriptURL ||
              existing.installing?.scriptURL ||
              existing.waiting?.scriptURL ||
              "";
            const knownSuffixes = ["/firebase-messaging-sw.js", "/sw.js"];
            if (!knownSuffixes.some((suffix) => scriptUrl.endsWith(suffix))) {
              existing.update().catch((error) => {
                console.warn("[sw] update échouée", error);
              });
            }
            return existing;
          }
          return navigator.serviceWorker.register(primarySwUrl.href, { scope: "./" });
        })
        .catch((error) => {
          console.warn("[sw] registration échouée", error);
          if (primarySwUrl.href !== legacySwUrl.href) {
            return navigator.serviceWorker
              .register(legacySwUrl.href, { scope: "./" })
              .catch((fallbackError) => {
                console.warn("[sw] registration fallback échouée", fallbackError);
                return null;
              });
          }
          return null;
        });
    })();
  </script>
  <script>
    (function setupInstallButton() {
      const installBanner = document.getElementById("install-banner");
      const installButtons = Array.from(document.querySelectorAll("[data-install-trigger]"));
      if (installButtons.length === 0) {
        if (installBanner) {
          installBanner.classList.add("hidden");
          installBanner.setAttribute("aria-hidden", "true");
        }
        return;
      }

      const buttonDefaults = new Map();
      installButtons.forEach((button) => {
        const text = (button.textContent || "").trim();
        buttonDefaults.set(button, text);
      });

      const primaryButton = document.getElementById("install-app-button") || installButtons[0];
      const primaryDefaultLabel = (buttonDefaults.get(primaryButton) || "📱 Ajouter à l’écran d’accueil");
      const supportsMatchMedia = typeof window.matchMedia === "function";
      const mediaMatches = (query) => (supportsMatchMedia ? window.matchMedia(query).matches : false);
      const isStandalone = mediaMatches("(display-mode: standalone)") || window.navigator.standalone === true;
      const userAgent = (window.navigator.userAgent || "").toLowerCase();
      const isiOS = /iphone|ipad|ipod/.test(userAgent);
      const isAndroid = /android/.test(userAgent);
      const hasTouch = "ontouchstart" in window || navigator.maxTouchPoints > 0;
      const isSmallViewport = mediaMatches("(max-width: 768px)");
      const isMobileDevice = (isiOS || isAndroid || (hasTouch && isSmallViewport));

      let deferredPrompt = null;

      function hideBanner() {
        if (!installBanner) return;
        installBanner.classList.add("hidden");
        installBanner.setAttribute("aria-hidden", "true");
      }

      function showBanner() {
        if (!installBanner) return;
        installBanner.classList.remove("hidden");
        installBanner.removeAttribute("aria-hidden");
      }

      function rememberCurrentInstallTarget() {
        const api = window.__appInstallTarget;
        if (!api || typeof api.save !== "function") {
          return;
        }
        try {
          api.save(window.location.hash || "");
        } catch (error) {
          console.warn("[install] target:remember", error);
        }
      }

      function showButton({ label } = {}) {
        if (isStandalone) return;
        installButtons.forEach((button) => {
          const defaultLabel = buttonDefaults.get(button) || primaryDefaultLabel;
          const nextLabel = label && button === primaryButton ? label : defaultLabel;
          button.textContent = nextLabel;
          button.classList.remove("hidden");
          button.disabled = false;
        });
      }

      function hideButton() {
        installButtons.forEach((button) => {
          button.classList.add("hidden");
          button.disabled = true;
        });
      }

      hideButton();
      if (isStandalone || !isMobileDevice) {
        hideBanner();
      } else {
        showBanner();
      }

      window.addEventListener("beforeinstallprompt", (event) => {
        event.preventDefault();
        deferredPrompt = event;
        showButton({ label: primaryDefaultLabel });
      });

      window.addEventListener("appinstalled", () => {
        rememberCurrentInstallTarget();
        deferredPrompt = null;
        showButton({ label: primaryDefaultLabel });
        hideBanner();
        if (window.__appBadge && typeof window.__appBadge.refresh === "function") {
          window.__appBadge.refresh().catch(() => {});
        }
      });

      if (isiOS && !isStandalone) {
        showButton({ label: "📱 Ajouter via Safari" });
      } else if (isMobileDevice && !isStandalone) {
        showButton({ label: primaryDefaultLabel });
      }

      installButtons.forEach((button) => {
        button.addEventListener("click", async () => {
          rememberCurrentInstallTarget();
          if (typeof window.__closeUserActionsMenu === "function") {
            window.__closeUserActionsMenu();
          }

          if (deferredPrompt) {
            deferredPrompt.prompt();
            try {
              const choice = await deferredPrompt.userChoice;
              deferredPrompt = null;
              if (choice?.outcome === "accepted") {
                showButton({ label: primaryDefaultLabel });
              }
            } catch (error) {
              console.warn("[install] prompt", error);
            }
            return;
          }

          if (isiOS && !isStandalone) {
            alert("Pour ajouter cette app à l’écran d’accueil, ouvre le menu de partage Safari puis choisis « Ajouter à l’écran d’accueil ».");
            return;
          }

          if ((isAndroid || isMobileDevice) && !isStandalone) {
            alert("Pour installer cette app, utilise le menu du navigateur (⋮) puis sélectionne « Ajouter à l’écran d’accueil ».");
            return;
          }

          alert("Utilise les options du navigateur pour ajouter cette page à l’écran d’accueil.");
        });
      });
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</body>
</html>
