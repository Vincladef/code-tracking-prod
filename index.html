<!doctype html>
<html lang="fr">
<head>
  <script>
    // Redirection automatique vers l'espace administrateur lorsqu'on arrive sur l'URL racine
    (function redirectToAdminOnRoot() {
      const { hash } = window.location;
      const isRootHash = hash === "" || hash === "#" || hash === "#/";
      if (!isRootHash) {
        return;
      }

      const isStandaloneDisplay = (() => {
        try {
          const mediaQueryMatch =
            typeof window.matchMedia === "function" && window.matchMedia("(display-mode: standalone)").matches;
          return mediaQueryMatch || window.navigator.standalone === true;
        } catch (error) {
          return window.navigator.standalone === true;
        }
      })();

      const INSTALL_TARGET_STORAGE_KEY = "hp::install::target";
      const INSTALL_TARGET_QUERY_PARAM = "installTarget";

      function serializeInstallTargetCookieValue(normalized) {
        const params = new URLSearchParams();
        params.set(INSTALL_TARGET_QUERY_PARAM, normalized);
        return params.toString();
      }

      function normalizeInstallTarget(hash) {
        if (!hash || typeof hash !== "string") return null;
        const trimmed = hash.trim();
        if (!trimmed) return null;
        if (/^#\/admin(?:\/|\?|$)/.test(trimmed)) {
          const [rawPath = "", searchPart = ""] = trimmed.split("?");
          const segments = rawPath.replace(/^#\/+/g, "").split("/");
          const normalizedHash = `#/${segments.filter(Boolean).join("/") || "admin"}`;
          return searchPart ? `${normalizedHash}?${searchPart}` : normalizedHash;
        }
        if (!/^#\/u\//.test(trimmed)) return null;
        const [rawPath = "", searchPart = ""] = trimmed.split("?");
        const segments = rawPath.replace(/^#\/+/g, "").split("/");
        if (!segments[1]) return null; // nécessite au moins un UID
        if (segments.length < 3 || !segments[2]) {
          segments[2] = "daily";
        }
        const normalizedHash = `#/${segments.filter(Boolean).join("/")}`;
        return searchPart ? `${normalizedHash}?${searchPart}` : normalizedHash;
      }

      function readInstallTargetCookie() {
        if (typeof document === "undefined" || typeof document.cookie !== "string") return null;
        try {
          const prefix = `${INSTALL_TARGET_STORAGE_KEY}=`;
          const rawCookie = document.cookie
            .split(";")
            .map((part) => part.trim())
            .find((part) => part.startsWith(prefix));
          if (!rawCookie) return null;
          const serialized = rawCookie.slice(prefix.length);
          if (!serialized) return null;
          const params = new URLSearchParams(serialized);
          const rawValue = params.get(INSTALL_TARGET_QUERY_PARAM);
          const normalized = normalizeInstallTarget(rawValue);
          if (!normalized) {
            clearStoredInstallTarget();
          }
          return normalized;
        } catch (error) {
          console.warn("[install] target:cookie:read", error);
          return null;
        }
      }

      function writeInstallTargetCookie(normalized) {
        if (typeof document === "undefined") return false;
        try {
          const serialized = serializeInstallTargetCookieValue(normalized);
          const maxAge = 60 * 60 * 24 * 365;
          const secureFlag = window.location?.protocol === "https:" ? " Secure;" : "";
          document.cookie = `${INSTALL_TARGET_STORAGE_KEY}=${serialized}; Max-Age=${maxAge}; Path=/; SameSite=Lax;${secureFlag}`;
          return true;
        } catch (error) {
          console.warn("[install] target:cookie:write", error);
          return false;
        }
      }

      function clearStoredInstallTarget() {
        try {
          const storage = window.localStorage;
          storage?.removeItem(INSTALL_TARGET_STORAGE_KEY);
        } catch (error) {
          console.warn("[install] target:storage:clear", error);
        }
        try {
          const secureFlag = window.location?.protocol === "https:" ? " Secure;" : "";
          document.cookie = `${INSTALL_TARGET_STORAGE_KEY}=; Max-Age=0; Path=/; SameSite=Lax;${secureFlag}`;
        } catch (error) {
          console.warn("[install] target:cookie:clear", error);
        }
      }

      function readInstallTargetFromQuery() {
        if (typeof URL !== "function") return null;
        try {
          const url = new URL(window.location.href);
          const raw = url.searchParams.get(INSTALL_TARGET_QUERY_PARAM);
          if (!raw) return null;
          const normalized = normalizeInstallTarget(raw);
          if (!normalized) {
            cleanupInstallTargetQuery();
            return null;
          }
          return normalized;
        } catch (error) {
          console.warn("[install] target:query:read", error);
          return null;
        }
      }

      function cleanupInstallTargetQuery() {
        if (typeof URL !== "function" || typeof window.history?.replaceState !== "function") return;
        try {
          const url = new URL(window.location.href);
          if (!url.searchParams.has(INSTALL_TARGET_QUERY_PARAM)) return;
          url.searchParams.delete(INSTALL_TARGET_QUERY_PARAM);
          const nextUrl = `${url.pathname}${url.search}${url.hash}`;
          window.history.replaceState(null, "", nextUrl);
        } catch (error) {
          console.warn("[install] target:query:cleanup", error);
        }
      }

      function readStoredInstallTarget() {
        try {
          const storage = window.localStorage;
          if (storage) {
            const raw = storage.getItem(INSTALL_TARGET_STORAGE_KEY);
            const normalized = normalizeInstallTarget(raw);
            if (normalized) return normalized;
            if (raw) {
              storage.removeItem(INSTALL_TARGET_STORAGE_KEY);
            }
          }
        } catch (error) {
          console.warn("[install] target:read", error);
        }
        const fromCookie = readInstallTargetCookie();
        if (fromCookie) {
          writeInstallTargetCookie(fromCookie);
          try {
            const storage = window.localStorage;
            storage?.setItem(INSTALL_TARGET_STORAGE_KEY, fromCookie);
          } catch (error) {
            console.warn("[install] target:storage:sync", error);
          }
        }
        return fromCookie;
      }

      const queryTarget = readInstallTargetFromQuery();
      const storedTarget = queryTarget ? null : readStoredInstallTarget();
      const targetHash = queryTarget || storedTarget || "#/daily";

      if (isStandaloneDisplay) {
        const normalized = targetHash.replace(/^#/, "");
        if (window.location.hash !== `#${normalized}`) {
          window.location.hash = normalized;
        }
        if (queryTarget) {
          cleanupInstallTargetQuery();
        }
        return;
      }

      if (queryTarget) {
        cleanupInstallTargetQuery();
      }
      const target = new URL("admin.html", window.location.href);
      window.location.replace(target.toString());
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#3ea6eb" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Habitudes &amp; Pratique" />
  <title>Habitudes &amp; Pratique</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%20512%20512%27%20role%3D%27img%27%20aria-label%3D%27Habitudes%20et%20Pratique%27%3E%0A%20%20%3Crect%20width%3D%27512%27%20height%3D%27512%27%20rx%3D%27116%27%20fill%3D%27%233EA6EB%27%2F%3E%0A%20%20%3Ctext%20x%3D%2750%25%27%20y%3D%2758%25%27%20text-anchor%3D%27middle%27%20font-family%3D%27%22Segoe%20UI%20Emoji%22%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Noto%20Color%20Emoji%22%2C%20sans-serif%27%20font-size%3D%27260%27%3E%F0%9F%8C%B1%3C%2Ftext%3E%0A%3C%2Fsvg%3E" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%20100%20100%27%20role%3D%27img%27%20aria-label%3D%27Habitudes%20et%20Pratique%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20rx%3D%2722%27%20fill%3D%27%233EA6EB%27%2F%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2760%25%27%20text-anchor%3D%27middle%27%20font-family%3D%27%22Segoe%20UI%20Emoji%22%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Noto%20Color%20Emoji%22%2C%20sans-serif%27%20font-size%3D%2748%27%3E%F0%9F%8C%B1%3C%2Ftext%3E%3C%2Fsvg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Pastels par section (par défaut = daily / bleu doux) */
      --accent-50:  #ECF7FF;
      --accent-200: #CFEBFF;
      --accent-400: #9FD7FF;
      --accent-600: #60BFFD;
      --accent-700: #3EA6EB;

      --card-bg: #ffffff;
      --page-bg: #F6F7FB;
      --text:    #334155; /* slate-700 */
      --muted:   #94A3B8; /* slate-400 */
      --ring:    var(--accent-400);
    }
    /* Pratique = vert doux */
    [data-section="practice"]{
      --accent-50:#F1FBF4; --accent-200:#D8F3E0; --accent-400:#BEE6C8; --accent-600:#8ED6A2; --accent-700:#63C582;
    }
    /* Objectifs = violet doux */
    [data-section="goals"]{
      --accent-50:#F7F3FF; --accent-200:#E9DFFF; --accent-400:#E3D0FF; --accent-600:#C7A7FF; --accent-700:#A884FF;
    }

    body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body{ background:var(--page-bg); color:var(--text); }

    .sr-only {
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    /* Cards blanches, coins 2xl, ombre douce */
    .card{ background:var(--card-bg); border:1px solid #E5E7EB; border-radius:1rem; box-shadow: 0 8px 24px rgba(16,24,40,.06); }

    /* Champs clairs + anneau pastel */
    input, textarea, select{
      background:#fff; border:1px solid #E5E7EB; color:var(--text); border-radius:.75rem; padding:.625rem .75rem;
    }
    input:focus, textarea:focus, select:focus{ outline:none; border-color:var(--ring); box-shadow:0 0 0 3px var(--accent-50); }

    /* Onglets (pills) + état actif coloré */
    .tabs{ display:flex; gap:.5rem; align-items:center; overflow-x:auto; flex-wrap:nowrap; -webkit-overflow-scrolling:touch; }
    .tabs::-webkit-scrollbar{ display:none; }
    body[data-section="admin"] .tabs .tab:not([data-nav="admin"]){ display:none; }
    .tab{ border:1px solid #E5E7EB; background:#fff; border-radius:999px; padding:.5rem .875rem; font-size:.9rem; display:inline-flex; gap:.5rem; align-items:center; white-space:nowrap; flex:0 0 auto; }
    .tab[aria-current="page"]{ background:var(--accent-50); border-color:var(--accent-400); color:#0B4B66; }

    /* cache le bouton Admin partout */
    [data-nav="admin"] { display: none !important; }

    /* Boutons */
    .btn{ border-radius:.75rem; padding:.625rem 1rem; font-weight:600; }
    .btn-primary{ background:var(--accent-600); color:#fff; }
    .btn-primary:hover{ background:var(--accent-700); }
    .btn-ghost{ background:transparent; border:1px solid var(--accent-200); color:#334155; }
    .btn-ghost:hover{ background:var(--accent-50); }
    .btn-danger{ background:#fee2e2; border:1px solid #fecaca; color:#b91c1c; }
    .btn-danger:hover{ background:#fecaca; }

    .install-banner{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; background:var(--accent-50); border:1px solid var(--accent-200); border-radius:1rem; padding:.65rem .85rem; font-size:.85rem; color:#0f172a; margin-bottom:1rem; }
    .install-banner__content{ display:flex; align-items:center; gap:.6rem; flex:1 1 auto; }
    .install-banner__icon{ font-size:1.4rem; }
    .install-banner__text{ display:flex; flex-direction:column; gap:2px; }
    .install-banner__title{ font-weight:600; }
    .install-banner__subtitle{ color:var(--muted); font-size:.8rem; }
    .install-banner__action{ display:inline-flex; align-items:center; gap:.25rem; font-weight:600; color:var(--accent-700); text-decoration:none; font-size:.82rem; flex-shrink:0; background:none; border:0; cursor:pointer; padding:0; font-family:inherit; }
    .install-banner__action:hover,
    .install-banner__action:focus-visible{ text-decoration:underline; outline:none; }

    /* Animation de changement d’onglet */
    @keyframes fadeSlideIn{ from{ opacity:0; transform:translateY(6px);} to{ opacity:1; transform:translateY(0);} }
    .route-enter{ animation: fadeSlideIn .25s ease-out; }

    /* Sidebar cachée par défaut (mode admin != user) */
    #sidebar{ display:none; }

    /* Titre un peu plus petit sur mobile */
    @media (max-width: 640px){
      header h1{ font-size:1rem; }
      .install-banner{ flex-direction:column; align-items:flex-start; text-align:left; }
      .install-banner__action{ padding-top:.25rem; }
      .day-nav{ min-width:0; width:100%; }
      .daily-header-actions{ margin-left:0; width:100%; justify-content:flex-start; flex-wrap:wrap; }
    }

    /* utilitaire pour masquer la scrollbar (déjà utilisé ci-dessus) */
    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Journalier — navigation par jour */
    .day-nav {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.5rem;
      padding:.35rem .5rem;
      border:1px solid rgba(148,163,184,.35);
      border-radius:999px;
      background:#fff;
      min-width:12.5rem;
      width:clamp(13rem, 70vw, 18rem);
    }
    .day-nav-btn {
      flex:0 0 auto;
      width:2.25rem;
      height:2.25rem;
      border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--text);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:1.1rem;
      cursor:pointer;
      transition:background .15s ease, border-color .15s ease;
    }
    .day-nav-btn:hover,
    .day-nav-btn:focus-visible {
      background:var(--accent-50);
      border-color:var(--accent-200);
      outline:none;
    }
    .day-nav-label {
      flex:1 1 auto;
      font-weight:600;
      font-size:.95rem;
      text-transform:capitalize;
      color:var(--text);
      display:flex;
      flex-direction:column;
      align-items:center;
      line-height:1.2;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .day-nav-today {
      font-size:.7rem;
      font-weight:500;
      color:var(--muted);
      letter-spacing:.03em;
      text-transform:uppercase;
    }

    /* Journalier — grille */
    .daily-grid {
      display:grid;
      gap:1.75rem;
      grid-template-columns:minmax(0, 1fr);
      justify-items:stretch;
      width:100%;
      box-sizing:border-box;
    }
    .daily-grid__item {
      grid-column:1 / -1;
      width:100%;
      box-sizing:border-box;
    }
    .daily-grid__actions {
      display:flex;
      justify-content:flex-end;
      width:100%;
    }

    /* Journalier — catégories */
    .daily-category {
      position:relative;
      background:#fff;
      border-radius:1.25rem;
      border:1px solid rgba(148,163,184,.2);
      padding:1.5rem 1.75rem;
      box-shadow:0 14px 32px rgba(15,23,42,.06);
      display:flex;
      flex-direction:column;
      width:100%;
      box-sizing:border-box;
    }
    .daily-category__header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding-bottom:.9rem;
      margin-bottom:1.1rem;
      border-bottom:1px solid rgba(148,163,184,.25);
      flex-wrap:nowrap;
    }
    .daily-category__name {
      font-weight:700;
      font-size:1.15rem;
      text-transform:capitalize;
      color:#0f172a;
      display:flex;
      align-items:center;
      gap:.5rem;
      flex:1 1 auto;
      min-width:0;
      word-break:break-word;
    }
    .daily-category__name::before {
      content:"";
      width:.55rem;
      height:.55rem;
      border-radius:999px;
      background:var(--accent-400);
    }
    .daily-category__count {
      font-size:.75rem;
      font-weight:600;
      color:var(--muted);
      padding:.2rem .4rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      margin-left:auto;
      flex:0 0 auto;
      text-align:right;
      align-self:center;
    }
    @media (max-width: 480px) {
      .daily-category {
        padding:1.1rem .85rem 1.3rem;
      }
      .daily-category__header {
        align-items:flex-start;
        flex-wrap:wrap;
        gap:.75rem;
      }
      .daily-category__count {
        margin-left:0;
        text-align:left;
        align-self:flex-start;
        width:100%;
      }
      .consigne-group__children {
        padding-inline:0;
      }
      .consigne-row {
        padding:.26rem 0;
      }
      .consigne-row--child {
        margin-left:.4rem;
        padding-left:.75rem;
        border-left:2px solid rgba(148,163,184,.2);
      }
      .consigne-actions__panel {
        min-width:12rem;
      }
    }
    @media (max-width: 360px) {
      html,
      body {
        font-size:clamp(14px, 4vw, 15px);
        line-height:1.45;
      }
      .daily-category {
        padding:.9rem .6rem 1rem;
      }
      .consigne-group__children {
        padding:.15rem .4rem .45rem;
      }
      .consigne-row {
        padding:.22rem 0;
      }
      .tab {
        padding:.4rem .65rem;
        font-size:.78rem;
        gap:.4rem;
      }
      .day-nav {
        padding:.25rem .4rem;
        gap:.35rem;
        min-width:11.5rem;
        width:clamp(11.5rem, 72vw, 15rem);
      }
      .day-nav-label {
        font-size:.85rem;
      }
      .day-nav-today {
        font-size:.65rem;
      }
      .daily-category__name {
        font-size:1rem;
        gap:.4rem;
      }
    }
    .daily-category__items {
      display:grid;
      gap:.14rem;
      flex:1 1 auto;
    }
    .daily-category__low {
      margin-top:.2rem;
      padding-top:.75rem;
    }
    .daily-category__low-summary {
      list-style:none;
      cursor:pointer;
      font-size:.8rem;
      font-weight:600;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:.35rem;
      padding-top:.75rem;
      border-top:1px dashed rgba(148,163,184,.35);
    }
    .daily-category__low-summary::-webkit-details-marker {
      display:none;
    }
    .daily-category__items--nested {
      margin-top:.45rem;
      display:grid;
      gap:.16rem;
    }
    ul.consigne-list {
      list-style:none;
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:0;
    }
    ul.consigne-list > li {
      margin:0;
    }
    .consigne-row {
      position:relative;
      display:flex;
      flex-direction:column;
      gap:.24rem;
      padding:.32rem 0;
      --consigne-status-bg:transparent;
      --consigne-status-border:rgba(148,163,184,.18);
      --consigne-status-text:#0f172a;
      --consigne-status-accent:#475569;
      --consigne-status-color:#94a3b8;
      --consigne-status-dot-shadow:rgba(148,163,184,.18);
      border-top:1px solid var(--consigne-status-border, rgba(148,163,184,.18));
      background:var(--consigne-status-bg, transparent);
      color:var(--consigne-status-text, #0f172a);
      border-radius:0;
      box-shadow:none;
      transition:background .2s ease, border-color .2s ease;
    }
    .consigne-row:first-child {
      border-top:none;
      padding-top:0;
    }
    .consigne-row + .consigne-row {
      margin-top:0;
    }
    .consigne-row.priority-surface,
    .consigne-row[class*="priority-surface-"] {
      background:transparent;
      border-color:transparent;
      box-shadow:none;
    }
    .consigne-row__header {
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:.35rem;
    }
    .consigne-row__main {
      display:flex;
      align-items:center;
      gap:.24rem;
      flex:1 1 auto;
      min-width:0;
    }
    .consigne-row__sr {
      flex:none;
      display:inline-flex;
      align-items:center;
    }
    .consigne-row__toggle {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:.3rem;
      width:100%;
      padding:0;
      margin:0;
      border:none;
      background:none;
      color:inherit;
      font:inherit;
      text-align:left;
      cursor:pointer;
    }
    .consigne-row__toggle:hover .consigne-row__title,
    .consigne-row__toggle:focus-visible .consigne-row__title {
      text-decoration:underline;
    }
    .consigne-row__toggle:focus-visible {
      outline:2px solid var(--accent-400);
      outline-offset:2px;
      border-radius:.5rem;
    }
    .consigne-row__title {
      font-weight:600;
      font-size:.98rem;
      color:var(--consigne-status-text, #0f172a);
      word-break:break-word;
    }
    .consigne-row__meta {
      display:flex;
      align-items:center;
      gap:.65rem;
      margin-left:auto;
      flex:0 0 auto;
      justify-content:flex-end;
    }
    .consigne-row__status {
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size:.8rem;
      font-weight:600;
      color:var(--consigne-status-accent, #475569);
    }
    .consigne-row__mark {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:.95rem;
      height:.95rem;
      font-size:.75rem;
      color:var(--consigne-status-accent, #475569);
      opacity:0;
      transform:scale(.9);
      transition:opacity .2s ease, transform .2s ease;
    }
    .consigne-row__mark::before {
      content:"\2713";
    }
    .consigne-row__mark--checked {
      opacity:.55;
      transform:scale(1);
    }
    .consigne-row__dot {
      width:.6rem;
      height:.6rem;
      border-radius:999px;
      background:var(--consigne-status-color, #94a3b8);
      flex:none;
      transition:background .2s ease, box-shadow .2s ease, transform .2s ease;
      box-shadow:0 0 0 3px var(--consigne-status-dot-shadow, rgba(148,163,184,.15));
    }
    .consigne-row[data-status="ok-strong"],
    .consigne-row__status[data-status="ok-strong"],
    .consigne-status--ok-strong {
      --consigne-status-bg:#dcfce7;
      --consigne-status-border:rgba(34,197,94,.28);
      --consigne-status-text:#14532d;
      --consigne-status-accent:#166534;
      --consigne-status-color:#16a34a;
      --consigne-status-dot-shadow:rgba(34,197,94,.25);
    }
    .consigne-row[data-status="ok-soft"],
    .consigne-row__status[data-status="ok-soft"],
    .consigne-status--ok-soft {
      --consigne-status-bg:#f0fdf4;
      --consigne-status-border:rgba(74,222,128,.24);
      --consigne-status-text:#166534;
      --consigne-status-accent:#15803d;
      --consigne-status-color:#4ade80;
      --consigne-status-dot-shadow:rgba(74,222,128,.22);
    }
    .consigne-row[data-status="mid"],
    .consigne-row__status[data-status="mid"],
    .consigne-status--mid {
      --consigne-status-bg:#fefce8;
      --consigne-status-border:rgba(234,179,8,.32);
      --consigne-status-text:#854d0e;
      --consigne-status-accent:#a16207;
      --consigne-status-color:#eab308;
      --consigne-status-dot-shadow:rgba(234,179,8,.24);
    }
    .consigne-row[data-status="ko-soft"],
    .consigne-row__status[data-status="ko-soft"],
    .consigne-status--ko-soft {
      --consigne-status-bg:#fef2f2;
      --consigne-status-border:rgba(248,113,113,.28);
      --consigne-status-text:#7f1d1d;
      --consigne-status-accent:#b91c1c;
      --consigne-status-color:#f87171;
      --consigne-status-dot-shadow:rgba(248,113,113,.24);
    }
    .consigne-row[data-status="ko-strong"],
    .consigne-row__status[data-status="ko-strong"],
    .consigne-status--ko-strong {
      --consigne-status-bg:#fee2e2;
      --consigne-status-border:rgba(220,38,38,.32);
      --consigne-status-text:#7f1d1d;
      --consigne-status-accent:#991b1b;
      --consigne-status-color:#dc2626;
      --consigne-status-dot-shadow:rgba(220,38,38,.26);
    }
    .consigne-row[data-status="na"],
    .consigne-row__status[data-status="na"],
    .consigne-status--na {
      --consigne-status-bg:#f8fafc;
      --consigne-status-border:rgba(148,163,184,.22);
      --consigne-status-text:#0f172a;
      --consigne-status-accent:#475569;
      --consigne-status-color:#94a3b8;
      --consigne-status-dot-shadow:rgba(148,163,184,.2);
    }
    .consigne-row__dot--ok-strong {
      background:#16a34a;
      box-shadow:0 0 0 3px rgba(34,197,94,.25);
    }
    .consigne-row__dot--ok-soft {
      background:#4ade80;
      box-shadow:0 0 0 3px rgba(74,222,128,.22);
    }
    .consigne-row__dot--mid {
      background:#eab308;
      box-shadow:0 0 0 3px rgba(234,179,8,.24);
    }
    .consigne-row__dot--ko-soft {
      background:#f87171;
      box-shadow:0 0 0 3px rgba(248,113,113,.24);
    }
    .consigne-row__dot--ko-strong {
      background:#dc2626;
      box-shadow:0 0 0 3px rgba(220,38,38,.26);
    }
    .consigne-row__dot--na {
      background:#94a3b8;
      box-shadow:0 0 0 3px rgba(148,163,184,.2);
    }
    .consigne-row__body {
      overflow:hidden;
      max-height:0;
      opacity:0;
      margin-top:0;
      transition:max-height .3s ease, opacity .2s ease;
    }
    .consigne-row.is-open .consigne-row__body {
      max-height:900px;
      opacity:1;
      margin-top:.65rem;
    }
    .consigne-row__body > * {
      margin-top:0;
    }
    .consigne-row--child {
      margin-left:.6rem;
      padding-left:.9rem;
      border-left:2px solid rgba(148,163,184,.2);
    }
    .consigne-row--child:first-child {
      border-top:none;
    }
    .consigne-row--child .consigne-row__header {
      gap:.42rem;
    }
    .daily-consigne__actions {
      position:relative;
      display:flex;
      align-items:center;
      flex:0 0 auto;
    }
    .consigne-actions__trigger {
      width:2.25rem;
      height:2.25rem;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0;
      border:1px solid rgba(148,163,184,.35);
      background:#fff;
      color:#475569;
      font-size:1.2rem;
      line-height:1;
      transition:background .2s ease, border-color .2s ease, color .2s ease, box-shadow .2s ease;
    }
    .consigne-actions__trigger:hover,
    .consigne-actions__trigger:focus-visible {
      background:var(--accent-50);
      border-color:var(--accent-200);
      color:#0f172a;
      outline:none;
      box-shadow:0 0 0 4px rgba(62,166,235,.18);
    }
    .consigne-actions__panel {
      position:absolute;
      right:0;
      top:calc(100% + .25rem);
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:.25rem;
      min-width:9rem;
      padding:.5rem;
      background:#fff;
      border:1px solid rgba(148,163,184,.35);
      border-radius:.75rem;
      box-shadow:0 10px 30px -12px rgba(15,23,42,.25);
      z-index:10;
    }
    .consigne-actions__panel[hidden] {
      display:none !important;
    }
    .consigne-actions__panel .btn {
      width:100%;
      justify-content:flex-start;
      padding:.5rem .75rem;
      border:none;
      background:transparent;
      color:#475569;
      font-weight:500;
      border-radius:.65rem;
    }
    .consigne-actions__panel .btn:hover,
    .consigne-actions__panel .btn:focus-visible {
      background:var(--accent-50);
      color:#0f172a;
      outline:none;
    }

    .consigne-group {
      display:grid;
      gap:.2rem;
    }
    .consigne-group__children {
      margin-top:-.2rem;
      padding:.18rem .6rem .52rem;
      border-radius:.85rem;
      background:rgba(148,163,184,.08);
      width:100%;
      box-sizing:border-box;
    }
    .consigne-group__summary {
      list-style:none;
      cursor:pointer;
      font-size:.8rem;
      font-weight:600;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:.4rem;
      padding:.35rem 0;
    }
    .consigne-group__summary::before {
      content:"▸";
      font-size:.75rem;
      transition:transform .2s ease;
    }
    .consigne-group__children[open] .consigne-group__summary::before {
      transform:rotate(90deg);
    }
    .consigne-group__summary::-webkit-details-marker {
      display:none;
    }
    .consigne-group__list {
      display:grid;
      gap:.28rem;
      margin-top:.28rem;
    }
    .consigne-card--child {
      margin-left:1rem;
      border-color:rgba(148,163,184,.28);
      box-shadow:none;
    }

    @media (min-width: 1024px) {
      .daily-grid {
        grid-template-columns:minmax(0, 1fr);
        justify-content:stretch;
        justify-items:stretch;
        align-items:start;
        gap:2rem;
      }
      .daily-grid__item {
        grid-column:auto;
      }
      .daily-grid__actions {
        grid-column:1 / -1;
      }
      .daily-category {
        height:100%;
        width:100%;
      }
    }

    .priority-surface {
      position:relative;
    }
    .priority-surface-high {
      background:#eff6ff;
      border-color:#bfdbfe;
      box-shadow:0 6px 18px rgba(59,130,246,0.18);
    }
    .priority-surface-medium {
      background:#ffffff;
      border-color:#e2e8f0;
    }
    .priority-surface-low {
      background:#f8fafc;
      border-color:#e2e8f0;
      box-shadow:0 4px 14px rgba(148,163,184,.12);
    }

    .consigne-card.priority-surface-high {
      background:#eff6ff;
      border-color:#bfdbfe;
      box-shadow:0 6px 18px rgba(59,130,246,0.18);
    }
    .consigne-card.priority-surface-low {
      background:#f8fafc;
      border-color:#e2e8f0;
    }

    .btn-saved{ background:#22C55E; } /* vert doux rapide pour le flash */

    .user-actions{ position:relative; display:flex; align-items:center; }
    .user-actions__trigger{ border:1px solid #E2E8F0; background:#fff; color:#475569; border-radius:999px; width:2.25rem; height:2.25rem; display:inline-flex; align-items:center; justify-content:center; font-size:1.25rem; transition:background .15s ease,border-color .15s ease,color .15s ease; }
    .user-actions__trigger:hover,
    .user-actions__trigger:focus-visible{ background:var(--accent-50); border-color:var(--accent-200); outline:none; color:#0f172a; }
    .user-actions__panel{ position:absolute; right:0; top:calc(100% + .5rem); display:flex; flex-direction:column; min-width:16rem; background:#fff; border:1px solid #E2E8F0; border-radius:1rem; box-shadow:0 20px 40px rgba(15,23,42,.16); padding:.5rem; z-index:40; }
    .user-actions__item{ width:100%; text-align:left; background:none; border:none; padding:.65rem .85rem; border-radius:.75rem; font:inherit; color:inherit; display:flex; align-items:center; gap:.5rem; cursor:pointer; transition:background .15s ease,color .15s ease; }
    .user-actions__item:hover,
    .user-actions__item:focus-visible{ background:var(--accent-50); outline:none; }
    .user-actions__separator{ height:1px; width:100%; background:#e2e8f0; margin:.25rem 0; }

    /* Objectifs */
    .goal-header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap; margin-bottom:12px; }
    .goal-nav{ display:flex; justify-content:center; }
    .goal-nav-button{ width:2.75rem; height:2.75rem; padding:0; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; font-size:1.1rem; }
    .goal-timeline{ display:grid; gap:12px; padding:8px 0; }
    .goal-month{ background:#fff; border-radius:16px; box-shadow:0 10px 28px rgba(79,70,229,.08); padding:16px; border:1px solid rgba(148,163,184,.2); }
    .goal-month--current{ border-color:var(--accent-400); box-shadow:0 12px 32px rgba(99,102,241,.14); }
    .goal-month__header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:1rem; }
    .goal-month__title{ margin:0; font-weight:700; font-size:1.15rem; text-transform:capitalize; }
    .goal-month__add{ padding:.35rem .9rem; border-radius:999px; font-size:.85rem; }
    .goal-monthly{ border:1px dashed rgba(148,163,184,.35); background:rgba(236,233,255,.6); border-radius:14px; padding:.85rem 1rem; margin-bottom:1rem; }
    .goal-monthly__title{ font-size:.85rem; font-weight:600; color:#5b21b6; text-transform:uppercase; letter-spacing:.03em; }
    .goal-week{ padding:10px 0; border-top:1px dashed #e5e7eb; }
    .goal-week:first-of-type{ border-top:none; padding-top:0; }
    .goal-week__header{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; margin-bottom:.45rem; }
    .goal-week__label{ font-size:.82rem; }
    .goal-week__add{ padding:.25rem .75rem; font-size:.78rem; border-radius:999px; }
    .goal-row{ display:flex; flex-direction:column; align-items:flex-start; gap:.75rem; padding:10px 12px; border-radius:12px; transition:background .15s ease, box-shadow .15s ease; border-left:4px solid transparent; }
    .goal-row:hover{ box-shadow:0 6px 14px rgba(15,23,42,.08); }
    .goal-row--positive{ background:#ecfdf5; border-left-color:#22c55e; }
    .goal-row--neutral{ background:#fefce8; border-left-color:#fbbf24; }
    .goal-row--negative{ background:#fef2f2; border-left-color:#f87171; }
    .goal-row--none{ background:#f8fafc; border-left-color:#94a3b8; }
    .goal-row--editable{ cursor:pointer; }
    .goal-row--editable .goal-quick,
    .goal-row--editable .goal-quick *{ cursor:auto; }
    .goal-title{ flex:1; width:100%; }
    .goal-title__button{ display:flex; flex-direction:column; align-items:flex-start; gap:2px; width:100%; background:none; border:none; padding:0; font:inherit; color:inherit; text-align:left; cursor:pointer; }
    .goal-title__button:hover .goal-title__text{ text-decoration:underline; }
    .goal-title__button:focus-visible{ outline:2px solid var(--accent-400); outline-offset:2px; border-radius:6px; }
    .goal-title__text{ font-weight:600; }
    .goal-title__subtitle{ color:var(--muted); font-size:.75rem; }
    .goal-quick{ width:100%; }
    .goal-quick select{ width:100%; }
    .goal-empty{ padding:1rem; border-radius:.75rem; background:var(--accent-50); }
    .select-compact{ font-size:.95rem; padding:4px 8px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }
    .select-compact:focus{ outline:none; border-color:var(--accent-400); box-shadow:0 0 0 3px var(--accent-50); }
    .week-picker{ display:flex; gap:.5rem; }
    .week-picker button.is-active{ background:var(--accent-600); color:#fff; border-color:var(--accent-600); }
    .goal-month-pill{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .75rem; border-radius:999px; background:var(--accent-50); border:1px solid var(--accent-200); font-size:.85rem; font-weight:600; color:#4338ca; }

    .history-scroll{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .history-table{ min-width:720px; }
    .goal-modal{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.7);
      display:grid;
      place-items:center;
      padding:1rem;
      z-index:50;
    }
    .goal-modal-card{ background:#fff; border-radius:1rem; padding:1.25rem 1.5rem; box-shadow:0 24px 48px rgba(15,23,42,.16); width:min(720px,95vw); max-height:90vh; overflow:auto; }
    .goal-modal-header{ display:flex; align-items:flex-start; justify-content:space-between; gap:1rem; }
    .goal-modal-title{ font-weight:700; font-size:1.1rem; }
    .goal-form{ display:grid; gap:1rem; margin-top:1rem; }
    .goal-field{ display:grid; gap:.4rem; }
    .goal-label{ font-size:.85rem; color:var(--muted); }
    .goal-input{ width:100%; }
    .goal-checkbox{ display:inline-flex; align-items:center; gap:.5rem; font-size:.9rem; color:#0f172a; }
    .goal-checkbox input{ width:1.1rem; height:1.1rem; accent-color:var(--accent-500,#4f46e5); }
    .goal-reminder{ display:grid; gap:.35rem; margin-left:1.75rem; }
    .goal-reminder__input{ width:min(220px,100%); }
    .goal-reminder__label{ font-size:.8rem; color:#64748B; }
    .goal-hint{ font-size:.75rem; color:var(--muted); }
    .goal-hint.is-disabled{ opacity:.6; }
    .goal-input[disabled]{ background:#f8fafc; color:#94a3b8; cursor:not-allowed; }
    .goal-actions{ display:flex; justify-content:flex-end; gap:.5rem; flex-wrap:wrap; }
    .goal-actions [data-delete]{ margin-right:auto; }
    .goal-list{ margin-top:.5rem; padding-left:1.25rem; display:grid; gap:.35rem; list-style:disc; }
    .objective-select{ gap:.35rem; }
    .objective-select__meta{ display:flex; align-items:center; flex-wrap:wrap; gap:.4rem; font-size:.8rem; color:#64748b; }
    .objective-select__badge{ display:inline-flex; align-items:center; gap:.35rem; padding:.15rem .6rem; border-radius:999px; background:var(--accent-50); border:1px solid var(--accent-200); font-size:.72rem; font-weight:600; color:#4338ca; }
    .objective-select__period{ font-size:.78rem; color:#475569; }
    .objective-select__placeholder{ font-size:.75rem; color:#94a3b8; }
    .goal-linker{ border:1px solid rgba(148,163,184,.25); background:transparent; border-radius:1rem; padding:.65rem .75rem; display:grid; gap:.65rem; }
    .goal-linker__controls{ display:flex; align-items:center; gap:.75rem; flex-wrap:wrap; }
    .goal-linker__summary{ font-size:.85rem; font-weight:500; color:#334155; }
    .goal-linker__hint{ margin:0; font-size:.8rem; color:#64748b; }
    .goal-linker__panel{ border:1px solid rgba(148,163,184,.25); background:#fff; border-radius:.75rem; padding:.5rem .65rem; display:grid; gap:.4rem; max-height:220px; overflow:auto; box-shadow:0 .35rem 1.2rem rgba(15,23,42,.08); }
    .goal-linker__panel[hidden]{ display:none; }
    .goal-linker__option{ display:grid; grid-template-columns:auto 1fr; align-items:flex-start; gap:.55rem; padding:.3rem .4rem; border-radius:.6rem; transition:background .15s ease, box-shadow .15s ease; }
    .goal-linker__option:hover{ background:rgba(99,102,241,.05); }
    .goal-linker__option input{ width:1.05rem; height:1.05rem; margin-top:.2rem; accent-color:var(--accent-500,#4f46e5); }
    .goal-linker__option-main{ font-weight:600; color:#1f2937; }
    .goal-linker__option-meta{ grid-column:2/span 1; font-size:.75rem; color:#64748b; }
    .goal-linker__empty{ margin:0; font-size:.85rem; color:#64748b; }
    .goal-linker__footer{ display:flex; justify-content:flex-end; }
    .goal-linker__toggle[disabled]{ opacity:.5; cursor:not-allowed; }
    .goal-linker__history[hidden]{ display:none; }


    .practice-dashboard.goal-modal{ display:flex; align-items:center; justify-content:center; padding:clamp(1.5rem,4vw,3rem); }
    .practice-dashboard.goal-modal .modal-card{ padding:0; background:transparent; box-shadow:none; border:0; }
    .practice-dashboard__card{
      width:min(720px,94vw);
      max-height:90vh;
      background:#fff;
      border-radius:1.2rem;
      border:1px solid rgba(148,163,184,0.2);
      box-shadow:0 18px 36px rgba(15,23,42,0.16);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .practice-dashboard__header{
      padding:1.5rem clamp(1.4rem,4vw,2rem) 1.1rem;
      display:flex;
      flex-direction:column;
      gap:.75rem;
      border-bottom:1px solid rgba(148,163,184,0.2);
      background:#fff;
    }
    .practice-dashboard__title-group{ display:flex; flex-direction:column; gap:.45rem; }
    .practice-dashboard__context{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .75rem; border-radius:999px; background:rgba(62,166,235,0.12); color:#0f4c75; font-size:.7rem; font-weight:600; text-transform:uppercase; letter-spacing:.12em; width:max-content; }
    .practice-dashboard__title{ margin:0; font-size:1.6rem; line-height:1.2; font-weight:700; color:#0f172a; }
    .practice-dashboard__subtitle{ margin:0; font-size:.9rem; color:#475569; line-height:1.5; }
    .practice-dashboard__close{ align-self:flex-end; border:1px solid rgba(148,163,184,0.4); background:#f1f5f9; color:#0f172a; border-radius:.75rem; padding:.45rem .8rem; cursor:pointer; transition:background .15s ease,border-color .15s ease; }
    .practice-dashboard__close:hover{ background:#e2e8f0; border-color:rgba(148,163,184,0.6); }
    .practice-dashboard__close:focus-visible{ outline:3px solid var(--accent-200); outline-offset:2px; }
    .practice-dashboard__body{
      flex:1;
      overflow-y:auto;
      padding:1.5rem clamp(1.4rem,4vw,2rem);
      background:#f8fafc;
      display:flex;
      flex-direction:column;
      gap:1.25rem;
    }
    .practice-dashboard__history{ display:flex; flex-direction:column; gap:1.25rem; }
    .practice-dashboard__history-grid{
      display:grid;
      gap:1.75rem;
      grid-template-columns:repeat(auto-fit, minmax(320px,1fr));
    }
    .practice-dashboard__history-section{
      background:#fff;
      border-radius:1rem;
      border:1px solid var(--history-border, rgba(148,163,184,0.24));
      padding:1.25rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      box-shadow:0 12px 24px rgba(15,23,42,0.08);
      border-top:4px solid var(--history-accent, rgba(99,102,241,0.4));
      background-image:linear-gradient(135deg, rgba(255,255,255,1) 0%, var(--history-soft, #f8fafc) 120%);
    }
    .practice-dashboard__history-header{ display:flex; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; gap:.75rem; }
    .practice-dashboard__history-heading-group{ display:flex; flex-direction:column; gap:.35rem; }
    .practice-dashboard__history-heading{ margin:0; font-size:1.1rem; font-weight:600; color:#0f172a; }
    .practice-dashboard__history-meta{ display:flex; flex-wrap:wrap; align-items:center; gap:.35rem; font-size:.8rem; color:#64748b; }
    .practice-dashboard__history-meta span{ display:inline-flex; align-items:center; gap:.25rem; }
    .practice-dashboard__history-meta-sep{ color:#cbd5f5; font-size:.75rem; }
    .practice-dashboard__history-tags{ display:flex; flex-wrap:wrap; align-items:center; gap:.4rem; }
    .practice-dashboard__chip{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.25rem .65rem;
      border-radius:999px;
      background:var(--history-soft, #f8fafc);
      border:1px solid var(--history-border, rgba(148,163,184,0.3));
      font-size:.72rem;
      font-weight:600;
      color:#4338ca;
    }
    .practice-dashboard__history-summary{
      display:grid;
      gap:1rem;
      grid-template-columns:repeat(auto-fit, minmax(180px,1fr));
    }
    .practice-dashboard__history-summary-item{
      display:flex;
      flex-direction:column;
      gap:.2rem;
      padding:.75rem;
      border-radius:.85rem;
      background:rgba(148,163,184,0.1);
    }
    .practice-dashboard__history-summary-label{
      font-size:.7rem;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#64748b;
      font-weight:600;
    }
    .practice-dashboard__history-summary-value{ font-size:1rem; font-weight:600; color:#0f172a; }
    .practice-dashboard__history-last-note{
      margin:0;
      font-size:.85rem;
      color:#475569;
      background:rgba(148,163,184,0.14);
      border-radius:.85rem;
      padding:.75rem .9rem;
      line-height:1.5;
    }
    .practice-dashboard__history-last-note-label{ font-weight:600; color:#1f2937; }
    .practice-dashboard__history-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:.75rem; }
    .practice-dashboard__history-item{ margin:0; }
    .practice-dashboard__history-entry{
      width:100%;
      border:1px solid var(--history-border, rgba(148,163,184,0.3));
      border-radius:.9rem;
      background:rgba(248,250,252,0.9);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:.75rem;
      padding:.85rem 1rem;
      font:inherit;
      color:inherit;
      text-align:left;
      cursor:pointer;
      transition:background .15s ease,border-color .15s ease,box-shadow .15s ease;
    }
    .practice-dashboard__history-entry:hover{ background:rgba(99,102,241,0.12); border-color:rgba(99,102,241,0.4); box-shadow:0 12px 22px rgba(99,102,241,0.18); }
    .practice-dashboard__history-entry:focus-visible{ outline:3px solid rgba(99,102,241,0.35); outline-offset:2px; }
    .practice-dashboard__history-entry-main{ display:flex; align-items:flex-start; gap:.65rem; flex:1 1 auto; min-width:0; }
    .practice-dashboard__history-entry-text{ display:flex; flex-direction:column; gap:.3rem; min-width:0; }
    .practice-dashboard__history-value{
      font-size:1.05rem;
      font-weight:600;
      color:#0f172a;
      white-space:nowrap;
      word-break:normal;
      overflow-wrap:break-word;
    }
    .practice-dashboard__history-note{ font-size:.85rem; color:#475569; line-height:1.4; word-break:break-word; }
    .practice-dashboard__history-date{ display:flex; flex-direction:column; align-items:flex-end; gap:.25rem; font-size:.78rem; color:#64748b; white-space:nowrap; }
    .practice-dashboard__history-date-main{ font-weight:600; color:#0f172a; }
    .practice-dashboard__history-date-sub{ font-size:.75rem; color:#94a3b8; }
    .practice-dashboard__history-meta-row{ font-size:.75rem; color:#64748b; }
    .practice-dashboard__history-dot{ width:.75rem; height:.75rem; border-radius:999px; background:#94a3b8; flex:none; margin-top:.2rem; }
    .practice-dashboard__history-dot--ok-strong{ background:#16a34a; }
    .practice-dashboard__history-dot--ok-soft{ background:#4ade80; }
    .practice-dashboard__history-dot--mid{ background:#eab308; }
    .practice-dashboard__history-dot--ko-soft{ background:#f87171; }
    .practice-dashboard__history-dot--ko-strong{ background:#dc2626; }
    .practice-dashboard__history-dot--na{ background:#94a3b8; }
    .practice-dashboard__empty{ padding:1rem; border-radius:.9rem; border:1px dashed rgba(148,163,184,0.5); background:#f8fafc; font-size:.9rem; color:#64748b; text-align:center; }
    .practice-dashboard__footer{ padding:1rem clamp(1.4rem,4vw,2rem); border-top:1px solid rgba(148,163,184,0.2); background:#fff; display:flex; justify-content:flex-end; }
    .practice-dashboard__footer-actions{ display:flex; gap:.75rem; }
    @media (max-width: 640px){
      .practice-dashboard.goal-modal{ padding:0; align-items:stretch; }
      .practice-dashboard.goal-modal .practice-dashboard__card{ width:100%; max-height:100dvh; border-radius:0; box-shadow:none; border:0; }
      .practice-dashboard.goal-modal .practice-dashboard__header{ padding:calc(env(safe-area-inset-top,0) + 1.25rem) 1.1rem 1rem; }
      .practice-dashboard.goal-modal .practice-dashboard__body{ padding:1.1rem; }
      .practice-dashboard.goal-modal .practice-dashboard__footer{ padding:1rem 1.1rem; }
      .practice-dashboard__history-grid{ grid-template-columns:1fr; }
      .practice-dashboard__history-entry{ flex-direction:column; align-items:flex-start; }
      .practice-dashboard__history-date{ align-items:flex-start; text-align:left; white-space:normal; }
      .practice-dashboard__history-value{ white-space:normal; }
      .history-panel__item-row{ flex-direction:column; align-items:flex-start; gap:.5rem; }
      .history-panel__actions{ width:100%; justify-content:space-between; }
      .history-panel__date{ width:100%; }
    }
    .practice-editor{ display:flex; flex-direction:column; gap:1rem; }
    .practice-editor__header{ display:flex; flex-direction:column; gap:.25rem; }
    .practice-editor__title{ font-size:1.05rem; font-weight:600; color:#0f172a; }
    .practice-editor__subtitle{ font-size:.85rem; color:#475569; }
    .practice-editor__section{ display:flex; flex-direction:column; gap:.4rem; }
    .practice-editor__label{ font-size:.75rem; text-transform:uppercase; letter-spacing:.08em; color:#475569; font-weight:600; }
    .practice-editor__value{ font-size:.9rem; color:#1f2937; }
    .practice-editor__input,
    .practice-editor__select,
    .practice-editor__textarea{ width:100%; border:1px solid #E2E8F0; border-radius:.75rem; padding:.55rem .7rem; font-size:.9rem; color:#334155; }
    .practice-editor__textarea{ min-height:96px; resize:vertical; }
    .practice-editor__input:focus-visible,
    .practice-editor__select:focus-visible,
    .practice-editor__textarea:focus-visible{ outline:3px solid var(--accent-200); outline-offset:1px; border-color:var(--accent-400); }
    .practice-editor__actions{ position:sticky; bottom:0; display:flex; justify-content:flex-end; gap:.5rem; padding:1rem 0 0; margin-top:1.25rem; border-top:1px solid #e2e8f0; background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%); }

    .history-panel{ display:flex; flex-direction:column; gap:1rem; }
    .history-panel__header{ display:flex; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; gap:.75rem; }
    .history-panel__title{ display:flex; flex-direction:column; gap:.35rem; }
    .history-panel__heading{ margin:0; font-size:1.2rem; font-weight:600; color:#0f172a; }
    .history-panel__subtitle{ margin:0; font-size:.85rem; color:#475569; }
    .history-panel__actions{ display:flex; flex-wrap:wrap; align-items:center; gap:.5rem; }
    .history-panel__badge{ display:inline-flex; align-items:center; gap:.35rem; padding:.3rem .7rem; border-radius:.75rem; background:rgba(99,102,241,0.1); color:#4338ca; font-size:.75rem; font-weight:600; }
    .history-panel__body{ max-height:70vh; overflow:auto; padding-right:.25rem; }
    .history-panel__list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:.75rem; }
    .history-panel__item{ padding:.85rem .9rem; border:1px solid rgba(148,163,184,0.28); border-radius:1rem; background:#fff; display:flex; flex-direction:column; gap:.45rem; box-shadow:0 10px 20px rgba(15,23,42,0.1); }
    .history-panel__item-row{ display:flex; align-items:flex-start; justify-content:space-between; gap:.75rem; flex-wrap:wrap; }
    .history-panel__value{ display:flex; align-items:center; gap:.55rem; font-size:1.05rem; font-weight:600; color:#0f172a; }
    .history-panel__dot{ width:.65rem; height:.65rem; border-radius:999px; background:#94a3b8; flex:none; }
    .history-panel__dot--ok{ background:#16a34a; }
    .history-panel__dot--mid{ background:#eab308; }
    .history-panel__dot--ko{ background:#dc2626; }
    .history-panel__dot--na{ background:#94a3b8; }
    .history-panel__date{ font-size:.8rem; color:#475569; }
    .history-panel__meta-row{ font-size:.75rem; color:#64748b; }
    .history-panel__meta{ display:inline-flex; align-items:center; gap:.25rem; background:rgba(148,163,184,0.16); padding:.25rem .55rem; border-radius:.75rem; }
    .history-panel__note{ margin:0; font-size:.85rem; color:#475569; line-height:1.45; word-break:break-word; }
    .history-panel__empty{ margin:0; padding:1rem; border-radius:.9rem; border:1px dashed rgba(148,163,184,0.45); background:#f8fafc; color:#64748b; font-size:.9rem; text-align:center; }

  </style>
</head>
<body class="min-h-screen">
  <div class="flex min-h-screen flex-col">
    <header class="border-b border-gray-200 bg-white">
      <div class="mx-auto w-full max-w-5xl px-4 py-4 relative">
        <div class="install-banner hidden" id="install-banner" aria-hidden="true">
          <div class="install-banner__content">
            <span class="install-banner__icon" aria-hidden="true">📲</span>
            <div class="install-banner__text">
              <span class="install-banner__title">Télécharger l’application</span>
              <span class="install-banner__subtitle">Ajoutez-la à votre écran d’accueil pour un accès rapide.</span>
            </div>
          </div>
          <button type="button" class="install-banner__action" id="install-banner-action" data-install-trigger>Télécharger</button>
        </div>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <h1 class="text-lg sm:text-xl font-semibold pr-12 sm:pr-0">
            Habitudes &amp; Pratique
            <span id="user-badge" style="margin-left:.5rem;color:#94a3b8;font-weight:600;">
              — <span data-username>…</span>
            </span>
          </h1>
          <nav class="tabs w-full sm:w-auto overflow-x-auto no-scrollbar">
            <button class="tab" data-route="#/admin" data-nav="admin"><span>🛠️</span><span>Admin</span></button>
            <button class="tab" data-route="#/daily"><span>📅</span><span>Journalier</span></button>
            <button class="tab" data-route="#/practice"><span>⚡</span><span>Pratique</span></button>
            <button class="tab" data-route="#/goals"><span>🎯</span><span>Objectifs</span></button>
          </nav>
          <div class="user-actions hidden absolute right-4 top-4 sm:static" id="user-actions" aria-hidden="true">
            <button type="button" class="user-actions__trigger" id="user-actions-trigger" aria-haspopup="true" aria-expanded="false" title="Actions">
              ⋮
            </button>
            <div class="user-actions__panel hidden" id="user-actions-panel" role="menu">
            <button type="button"
                    class="user-actions__item"
                    id="user-actions-notifications"
                    data-notif-toggle
                    data-uid=""
                    data-enabled="0"
                    role="menuitem">
              🔔 Activer les notifications
            </button>
            <div class="user-actions__separator" role="presentation"></div>
            <button type="button"
                    class="user-actions__item hidden"
                    id="install-app-button"
                    data-install-trigger
                    role="menuitem">
              📱 Ajouter à l’écran d’accueil
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="mx-auto flex w-full max-w-5xl flex-col gap-4 px-4 py-6">
        <aside id="sidebar"></aside>
        <div id="view-root">Chargement…</div>
      </div>
    </main>

    <footer class="border-t border-gray-200 py-6 text-center text-sm text-[var(--muted)]">
      &copy; Habitudes &amp; Pratique
    </footer>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>
  <script src="schema.js"></script>
  <script src="modes.js"></script>
  <script src="goals.js"></script>
  <script src="autosave.js"></script>
  <script src="app.js"></script>
  <script>
    (function initApp() {
      if (!window.firebase) {
        console.error("Firebase non chargé");
        return;
      }
      const cfg = {
        apiKey: "AIzaSyAQcvZ9a2j4MHF04RjMHIey0R_iwnjZf4o",
        authDomain: "tracking-d-habitudes.firebaseapp.com",
        projectId: "tracking-d-habitudes",
        storageBucket: "tracking-d-habitudes.firebasestorage.app",
        messagingSenderId: "739389871966",
        appId: "1:739389871966:web:684e26dbdfb0c0a69221cf",
        measurementId: "G-ZPHWB5DKWF"
      };
      const app = firebase.initializeApp(cfg);
      const db = firebase.firestore(app);
      if (typeof startRouter === "function") {
        startRouter(app, db);
      } else {
        console.error("startRouter indisponible");
      }
    })();
  </script>
  <script>
    (function registerAppServiceWorker() {
      if (!("serviceWorker" in navigator)) {
        return;
      }

      if (window.__appSWRegistrationPromise) {
        return;
      }

      const primarySwUrl = new URL("firebase-messaging-sw.js", window.location.href);
      const legacySwUrl = new URL("sw.js", window.location.href);
      window.__appSWRegistrationPromise = navigator.serviceWorker
        .getRegistration()
        .then((existing) => {
          if (existing) {
            const scriptUrl =
              existing.active?.scriptURL ||
              existing.installing?.scriptURL ||
              existing.waiting?.scriptURL ||
              "";
            const knownSuffixes = ["/firebase-messaging-sw.js", "/sw.js"];
            if (!knownSuffixes.some((suffix) => scriptUrl.endsWith(suffix))) {
              existing.update().catch((error) => {
                console.warn("[sw] update échouée", error);
              });
            }
            return existing;
          }
          return navigator.serviceWorker.register(primarySwUrl.href, { scope: "./" });
        })
        .catch((error) => {
          console.warn("[sw] registration échouée", error);
          if (primarySwUrl.href !== legacySwUrl.href) {
            return navigator.serviceWorker
              .register(legacySwUrl.href, { scope: "./" })
              .catch((fallbackError) => {
                console.warn("[sw] registration fallback échouée", fallbackError);
                return null;
              });
          }
          return null;
        });
    })();
  </script>
  <script>
    (function setupInstallButton() {
      const installBanner = document.getElementById("install-banner");
      const installButtons = Array.from(document.querySelectorAll("[data-install-trigger]"));
      if (installButtons.length === 0) {
        if (installBanner) {
          installBanner.classList.add("hidden");
          installBanner.setAttribute("aria-hidden", "true");
        }
        return;
      }

      const buttonDefaults = new Map();
      installButtons.forEach((button) => {
        const text = (button.textContent || "").trim();
        buttonDefaults.set(button, text);
      });

      const primaryButton = document.getElementById("install-app-button") || installButtons[0];
      const primaryDefaultLabel = (buttonDefaults.get(primaryButton) || "📱 Ajouter à l’écran d’accueil");
      const supportsMatchMedia = typeof window.matchMedia === "function";
      const mediaMatches = (query) => (supportsMatchMedia ? window.matchMedia(query).matches : false);
      const isStandalone = mediaMatches("(display-mode: standalone)") || window.navigator.standalone === true;
      const userAgent = (window.navigator.userAgent || "").toLowerCase();
      const isiOS = /iphone|ipad|ipod/.test(userAgent);
      const isAndroid = /android/.test(userAgent);
      const hasTouch = "ontouchstart" in window || navigator.maxTouchPoints > 0;
      const isSmallViewport = mediaMatches("(max-width: 768px)");
      const isMobileDevice = (isiOS || isAndroid || (hasTouch && isSmallViewport));

      let deferredPrompt = null;

      function hideBanner() {
        if (!installBanner) return;
        installBanner.classList.add("hidden");
        installBanner.setAttribute("aria-hidden", "true");
      }

      function showBanner() {
        if (!installBanner) return;
        installBanner.classList.remove("hidden");
        installBanner.removeAttribute("aria-hidden");
      }

      function rememberCurrentInstallTarget() {
        const api = window.__appInstallTarget;
        if (!api || typeof api.save !== "function") {
          return;
        }
        try {
          api.save(window.location.hash || "");
        } catch (error) {
          console.warn("[install] target:remember", error);
        }
      }

      function showButton({ label } = {}) {
        if (isStandalone) return;
        installButtons.forEach((button) => {
          const defaultLabel = buttonDefaults.get(button) || primaryDefaultLabel;
          const nextLabel = label && button === primaryButton ? label : defaultLabel;
          button.textContent = nextLabel;
          button.classList.remove("hidden");
          button.disabled = false;
        });
      }

      function hideButton() {
        installButtons.forEach((button) => {
          button.classList.add("hidden");
          button.disabled = true;
        });
      }

      hideButton();
      if (isStandalone || !isMobileDevice) {
        hideBanner();
      } else {
        showBanner();
      }

      window.addEventListener("beforeinstallprompt", (event) => {
        event.preventDefault();
        deferredPrompt = event;
        showButton({ label: primaryDefaultLabel });
      });

      window.addEventListener("appinstalled", () => {
        rememberCurrentInstallTarget();
        deferredPrompt = null;
        showButton({ label: primaryDefaultLabel });
        hideBanner();
        if (window.__appBadge && typeof window.__appBadge.refresh === "function") {
          window.__appBadge.refresh().catch(() => {});
        }
      });

      if (isiOS && !isStandalone) {
        showButton({ label: "📱 Ajouter via Safari" });
      } else if (isMobileDevice && !isStandalone) {
        showButton({ label: primaryDefaultLabel });
      }

      installButtons.forEach((button) => {
        button.addEventListener("click", async () => {
          rememberCurrentInstallTarget();
          if (typeof window.__closeUserActionsMenu === "function") {
            window.__closeUserActionsMenu();
          }

          if (deferredPrompt) {
            deferredPrompt.prompt();
            try {
              const choice = await deferredPrompt.userChoice;
              deferredPrompt = null;
              if (choice?.outcome === "accepted") {
                showButton({ label: primaryDefaultLabel });
              }
            } catch (error) {
              console.warn("[install] prompt", error);
            }
            return;
          }

          if (isiOS && !isStandalone) {
            const message = [
              "Pour installer l’app sur iPhone/iPad :",
              "1. Ouvre cette page dans Safari.",
              "2. Appuie sur le bouton « Partager » (carré avec une flèche).",
              "3. Choisis « Ajouter à l’écran d’accueil ».",
              "4. Valide avec « Ajouter », puis lance l’app depuis la nouvelle icône.",
            ].join("\n");
            alert(message);
            return;
          }

          if ((isAndroid || isMobileDevice) && !isStandalone) {
            alert("Pour installer cette app, utilise le menu du navigateur (⋮) puis sélectionne « Ajouter à l’écran d’accueil ».");
            return;
          }

          alert("Utilise les options du navigateur pour ajouter cette page à l’écran d’accueil.");
        });
      });
    })();
  </script>
</body>
</html>
