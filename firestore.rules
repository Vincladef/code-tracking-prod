// Firestore rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /u/{uid} {
      // Accès au document profil de l'utilisateur
      allow read, write: if request.auth != null && request.auth.uid == uid;

      match /pushTokens/{token} {
        allow read: if request.auth != null && request.auth.uid == uid;
        allow write: if request.auth != null && request.auth.uid == uid;
      }

      match /objectifs/{objectifId} {
        allow read: if request.auth != null && request.auth.uid == uid;
        allow write: if request.auth != null && request.auth.uid == uid;
      }

      match /consignes/{cid} {
        allow read: if request.auth != null && request.auth.uid == uid;
        allow write: if request.auth != null && request.auth.uid == uid;
        // (pas de restriction spécifique : le champ objectiveId est librement éditable par l’owner)
      }

      // Autres sous-collections de l'utilisateur (categories, responses, etc.)
      match /{document=**} {
        allow read, write: if request.auth != null && request.auth.uid == uid;
      }
    }

    // Bloquer tout le reste
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
